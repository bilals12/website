<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gdbExtract</title>
    
<head>
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>gdbExtract</title>
<meta name="description" content="">


<meta property="og:title" content="gdbExtract">
<meta property="og:description" content="">

    
    



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="gdbExtract">
<meta name="twitter:description" content="">

    
    


    <base href="/">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    
<div id="content-area" data-page-type="single">
    <article id="post">
        <header>
            <h1 id="post-title">gdbExtract</h1>
            <br>
            <time datetime="2023-11-27T13:43:26-05:00" class="post-date-time">
                Nov 27, 2023
            </time>
        </header>
        <div id="post-content">
            <p>over the past few days, i&rsquo;ve been writing tools that automate cumbersome manual tasks and make my workflow/toolchain cleaner and pushing them to my personal github. the latest one in this series is a tool i call <strong><a href="https://github.com/bilals12/gdbExtract">gdbExtract</a></strong>.</p>
<p>as a security researcher, i spend a lot of time diving deep into the worlds of software security and system analysis. in these domains, binary analysis and reverse engineering are critical tasks, but their challenging and complex nature can come across as intimidating. hackers rely on this fact to conceal a myriad of functions inside binaries that perform unwanted actions, but this tool can help shed some light on them. it&rsquo;s not exactly a replacement for popular and powerful applications like IDA Pro, but it&rsquo;s a quick way to reveal hidden and integral information about binaries.</p>
<p><strong>gdbExtract</strong> is, first and foremost, an automation tool. it was created to streamline the tedious process of binary analysis. manually examining binaries using tools like <code>GDB</code> requires significant effort and expertise. <code>gdbExtract</code> automates the extraction of crucial function information, transforming a potentially labour-intensive task into a quicker and more reliable process.</p>
<ul>
<li>efficiency: automating the extraction process saves time but also ensures consistent results (crucial when dealing with multiple or large binaries).</li>
<li>structured output: by outputting data in a JSON format, the script turns raw, hard-to-parse information into a structured form, paving the way for more advanced analysis techniques.</li>
<li>versatility and accessibility: the script is designed to be noob-friendly but can also help seasoned professionals.</li>
</ul>
<h1 id="core-functionalities">core functionalities</h1>
<p><strong>note</strong>: before running, edit the script to point to your specific binary file and output file. there&rsquo;s also a list of &ldquo;unsafe&rdquo; function strings, that you can edit to fit your criteria.</p>
<p>here&rsquo;s the script in its entirety.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> List, Dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># configure basic logging to display errors and info</span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># constants for file paths and binary to be analyzed</span>
</span></span><span style="display:flex;"><span>BINARY_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/path/to/binary&#34;</span>
</span></span><span style="display:flex;"><span>DATA_FILE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;path/to/file.json&#34;</span>
</span></span><span style="display:flex;"><span>riskyFunctions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;strcpy&#39;</span>, <span style="color:#e6db74">&#39;strncpy&#39;</span>, <span style="color:#e6db74">&#39;memcpy&#39;</span>, <span style="color:#e6db74">&#39;memset&#39;</span>, <span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;recv&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GDB command to list all functions in binary</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># returns output from GDB as string</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_gdb_command</span>(binary_path: str) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> subprocess<span style="color:#f92672">.</span>check_output([<span style="color:#e6db74">&#34;gdb&#34;</span>, <span style="color:#e6db74">&#34;-batch&#34;</span>, <span style="color:#e6db74">&#34;-ex&#34;</span>, <span style="color:#e6db74">&#34;info functions&#34;</span>, binary_path])
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">except</span> subprocess<span style="color:#f92672">.</span>CalledProcessError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>		logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;GDB command failed: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>		sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># parse output from GDB to extract function info</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># returns list of dicts, each containing details of single function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_gdb_output</span>(gdb_output: str) <span style="color:#f92672">-&gt;</span> List[Dict]:
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> gdb_output<span style="color:#f92672">.</span>splitlines():
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> line<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;0x&#34;</span>): <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		address, name, signature <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>		json_data<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#34;address&#34;</span>: address, <span style="color:#e6db74">&#34;name&#34;</span>: name, <span style="color:#e6db74">&#34;signature&#34;</span>: signature})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> json_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># reads json file and returns content</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_json_file</span>(file_path: str) <span style="color:#f92672">-&gt;</span> List[Dict]:
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">with</span> open(file_path, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>load(file)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IOError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>		logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;error reading file </span><span style="color:#e6db74">{</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">except</span> json<span style="color:#f92672">.</span>JSONDecodeError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>		logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;error decoding JSON from file </span><span style="color:#e6db74">{</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># writes list of dicts to json file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write_json_file</span>(file_path: str, data: List[Dict]):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">with</span> open(file_path, <span style="color:#e6db74">&#34;w&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>			json<span style="color:#f92672">.</span>dump(data, file, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>) <span style="color:#75715e"># indentation for readability</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IOError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>		logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;error writing to file </span><span style="color:#e6db74">{</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main function that extracts function info from binary via GDB</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main_search_code</span>():
</span></span><span style="display:flex;"><span>	gdb_output <span style="color:#f92672">=</span> run_gdb_command(BINARY_PATH)
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> parse_gdb_output(gdb_output)
</span></span><span style="display:flex;"><span>	write_json_file(DATA_FILE, json_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># filters out functions deemed &#34;safe&#34; and writes the rest to new json file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove_safe_functions</span>():
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> read_json_file(DATA_FILE)
</span></span><span style="display:flex;"><span>	filtered_json_data <span style="color:#f92672">=</span> [func <span style="color:#66d9ef">for</span> func <span style="color:#f92672">in</span> json_data <span style="color:#66d9ef">if</span> func[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> riskyFunctions]
</span></span><span style="display:flex;"><span>	write_json_file(<span style="color:#e6db74">&#34;filtered_file.json&#34;</span>, filtered_json_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># combines multiple entries of the same function into a single record</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tracks number of occurrences of each function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">combine_data_for_same_function</span>():
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> read_json_file(<span style="color:#e6db74">&#34;filtered_file.json&#34;</span>)
</span></span><span style="display:flex;"><span>	combined_json_data <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> func <span style="color:#f92672">in</span> json_data:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> func[<span style="color:#e6db74">&#34;name&#34;</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> combined_json_data:
</span></span><span style="display:flex;"><span>			combined_json_data[func[<span style="color:#e6db74">&#34;name&#34;</span>]] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;addresses&#34;</span>: [func[<span style="color:#e6db74">&#34;address&#34;</span>]],
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;signature&#34;</span>: func[<span style="color:#e6db74">&#34;signature&#34;</span>],
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;count&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			combined_json_data[func[<span style="color:#e6db74">&#34;name&#34;</span>]][<span style="color:#e6db74">&#34;addresses&#34;</span>]<span style="color:#f92672">.</span>append(func[<span style="color:#e6db74">&#34;address&#34;</span>])
</span></span><span style="display:flex;"><span>			combined_json_data[func[<span style="color:#e6db74">&#34;name&#34;</span>]][<span style="color:#e6db74">&#34;count&#34;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	write_json_file(<span style="color:#e6db74">&#34;combined_file.json&#34;</span>, combined_json_data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lists all functions in json data file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list_functions</span>():
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> read_json_file(DATA_FILE)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> func <span style="color:#f92672">in</span> json_data:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>func[<span style="color:#e6db74">&#39;address&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>func[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># searches for specific function in json data file by address or name</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search_function</span>():
</span></span><span style="display:flex;"><span>	json_data <span style="color:#f92672">=</span> read_json_file(DATA_FILE)
</span></span><span style="display:flex;"><span>	func_addr_name <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;enter a function address or name: &#34;</span>)
</span></span><span style="display:flex;"><span>	found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> func <span style="color:#f92672">in</span> json_data:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> func[<span style="color:#e6db74">&#34;address&#34;</span>] <span style="color:#f92672">==</span> func_addr_name <span style="color:#f92672">or</span> func[<span style="color:#e6db74">&#34;name&#34;</span>] <span style="color:#f92672">==</span> func_addr_name:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;found </span><span style="color:#e6db74">{</span>func[<span style="color:#e6db74">&#39;address&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>func[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>			found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> found:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;could not find function with address or name &#39;</span><span style="color:#e6db74">{</span>func_addr_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main entry point</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># handles cli args and calls corresponding functions</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># check if correct number of args are passed</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>		command <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># execute function based on arg</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;search&#34;</span>:
</span></span><span style="display:flex;"><span>			main_search_code()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;remove-safe&#34;</span>:
</span></span><span style="display:flex;"><span>			remove_safe_functions()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;combine&#34;</span>:
</span></span><span style="display:flex;"><span>			combine_data_for_same_function()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> command <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;list&#34;</span>:
</span></span><span style="display:flex;"><span>			list_functions()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;unknown command. please enter a valid option.&#34;</span>)
</span></span><span style="display:flex;"><span>			sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;incorrect number of args.&#34;</span>)
</span></span><span style="display:flex;"><span>		sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># run script only if script is executed as main program</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>	main()
</span></span></code></pre></div><h2 id="analysis">analysis</h2>
<p>the script is great for quickly sifting through binaries to identify potential vulnerabilities.</p>
<ol>
<li>run <code>python gdbExtract.py search</code> to extract a comprehensive list of functions from the binary.</li>
<li>running <code>python gdbExtract.py remove-safe</code> afterwards will filter out the &ldquo;known&rdquo; safe functions, narrowing the focus toward more critical areas.</li>
</ol>
<p>extracted data might look something like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;0x00401350&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;int main()&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;0x00401390&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;helper_function&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;void helper_function(int)&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h2 id="reverse-engineering">reverse engineering</h2>
<p>it can also dissect a binary so the user can understand its behavior or uncover hidden functionalities.</p>
<p>after extracting function data, run <code>python gdbExtract.py combine</code> to identify duplicate functions, which might indicate areas of complexity or reuse of code worth exploring.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;helper_function&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;addresses&#34;</span>: [<span style="color:#e6db74">&#34;0x00401390&#34;</span>, <span style="color:#e6db74">&#34;0x00401500&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;signature&#34;</span>: <span style="color:#e6db74">&#34;void helper_function(int)&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;count&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="education">education</h2>
<p>it can aid instructors or teachers in explaining the structure and intricacies of binaries in a practical manner.</p>
<ol>
<li>run <code>python gdbExtract.py list</code> to explore the different functions within a binary.</li>
</ol>
<p>the output can look something like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>0x00401350: main
</span></span><span style="display:flex;"><span>0x00401390: helper_function
</span></span></code></pre></div><ol start="2">
<li>run <code>python gdbExtract.py find</code> to search for specific functions. this can demonstrate how functions relate to each other.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>enter a <span style="color:#66d9ef">function</span> address or name: main
</span></span><span style="display:flex;"><span>found 0x00401350: main
</span></span></code></pre></div><h1 id="corner-cases">corner cases</h1>
<p>every tool has its limitations. <code>gdbExtract</code> might not effectively parse binaries that utilize heavily obfuscated code. also, its reliance on GDB means it inherits any limitations present within GDB, such as handling certain types of binaries or specific configs.</p>
<h1 id="thought-experiment">thought experiment</h1>
<p>let&rsquo;s say i&rsquo;m a security researcher (i am lol), and i want to assess the security of a legacy communications software that my organization has been using for over a decade. i suspect that the software might contain undiscovered vulnerabilities.</p>
<ol>
<li>running the script</li>
</ol>
<ul>
<li>i quickly run <code>python gdbExtract.py search</code> to analyze the binary (specified in <code>BINARY_PATH</code>).</li>
<li>it will output a comprehensive list of all functions within the binary, complete with their memory addresses and signatures.</li>
<li>i now have a clear and structured overview of the binary&rsquo;s functions + hours of saved time.</li>
</ul>
<ol start="2">
<li>filtering safe functions</li>
</ol>
<ul>
<li>run <code>python gdbExtract.py remove-safe</code> to streamline the dataset.</li>
<li>this will isolate functions that warrant closer scrutiny.</li>
<li>it filters out functions that were pre-identified as &ldquo;safe&rdquo;, based on individual critieria (in this case, i&rsquo;ve excluded standard library functions and those without direct external input handling).</li>
<li>i now have a manageable list of functions that are labeled &ldquo;high-risk&rdquo; (related to network data handling, memory manipulation, etc).</li>
</ul>
<ol start="3">
<li>identification</li>
</ol>
<ul>
<li>i come across a function called <code>processClientRequest</code>.</li>
<li>this function handles incoming data packets from network clients, interacting directly with external data.</li>
</ul>
<p>diving into the source code of the <code>processClientRequest</code> function, i discover that it uses <code>strcpy</code> to data from the network buffer to a local buffer. this is an immediate red flag, as <code>strcpy</code> doesn&rsquo;t check the size of the destination buffer, making it vulnerable to buffer overflow attacks if the source data exceeds the buffer&rsquo;s capacity. even worse, <code>processClientRequest</code> lacked any checks on the size of the incoming data, meaning it blindly copied whatever was sent over the network into the local buffer.</p>
<ol start="4">
<li>constructing a proof-of-concept</li>
</ol>
<ul>
<li>i create a network packet with data significantly larger than the buffer size inside the <code>processClientRequest</code> function (have it contain a specific pattern that&rsquo;s easily identifiable in the memory if it overflows, like <code>AAAAAAAA</code>).</li>
<li>i then send the packet to a controlled environment (VM) using the legacy software and monitor the memory state of the software as it processes the packet (Immunity Debugger is great for this).</li>
<li>as expected, the packet causes a buffer overflow and overwrites the adjacent memory.</li>
<li>this can be confirmed by checking for the pattern in memory locations outside the buffer.</li>
<li>the packet can be modified to include a simple payload that would then write itself into the program memory.</li>
</ul>
<ol start="5">
<li>remediation</li>
</ol>
<ul>
<li>replace <code>strcpy</code> with <code>strncpy</code>, which includes buffer size as an argument, ensuring copied data does not exceed buffer limit.</li>
<li>use checks to validate the size of incoming data before processing it.</li>
<li>review the code with the help of 1 or more code reviewers, and test it using various packet sizes.</li>
</ul>
<p>hope this tool finds you well! feel free to leave comments on my <a href="https://github.com/bilals12">github</a> and explore some of my other programs as well.</p>

        </div>
    </article>
</div>

    
     <script src="/p5/p5.min.js"></script>
     <script src="/js/genart.js"></script>
     <script src="/js/main.js"></script>
</body>
</html>